INSERT INTO `!PREFIX!_mod` VALUES (3, 1, 'Article_Include', 'Content', 'none', 'This module includes an article into an other\r\n\r\nAuthor: Willi Man, Andreas Lindner, 4fb, B. Behrens\r\nVersion: 1.1', NULL, '?><?php\r\n/**\r\n* $RCSfile$\r\n*\r\n* Description: Article Include Input\r\n*\r\n* @version 1.0.0\r\n* @author Willi Man\r\n* @copyright four for business AG <www.4fb.de>\r\n*\r\n* {@internal\r\n* created 2003-12-18\r\n* modified 2004-01-02\r\n* modified 2005-08-05 Andreas Lindner\r\n* }}\r\n*/\r\n\r\n#Get current settings\r\n$name         = "CMS_VAR[1]";\r\n$cms_idcat    = "CMS_VALUE[1]";\r\n$cms_idcatart = "CMS_VALUE[2]";\r\n\r\n#Cat selector\r\necho buildCategorySelect($name, $cms_idcat);\r\n\r\n$bDebug = false;\r\nif ($bDebug)\r\n    echo "<pre>cat $cms_idcat catart $cms_idcatart client $client lang $lang <br>webpath ".$cfgClient[$client][''path''][''htmlpath'']."</pre>";\r\n\r\necho ''<table cellpadding="0" cellspacing="0" border="0">'';\r\n\r\n#Article selector\r\necho ''\r\n      <tr><td class="text_medium" style="padding:5px">''.mi18n("Artikel w?hlen").'': </td></tr>\r\n      <tr><td class="text_medium" style="padding:5px">'';\r\necho ''<select name="CMS_VAR[2]" style="width:240px">'';\r\necho ''<option value="" selected>''.i18n("Please choose").''</option>'';\r\n\r\nif ($cms_idcat != "0" && strlen($cms_idcat) > 0) {\r\n    $sql = "SELECT\r\n                        a.title AS title,\r\n                        b.idcatart AS idcatart\r\n                    FROM\r\n                        ".$cfg["tab"]["art_lang"]." AS a,\r\n                        ".$cfg["tab"]["cat_art"]." AS b\r\n                        WHERE\r\n                        b.idcat = ''".$cms_idcat."'' AND\r\n                        a.idart = b.idart AND\r\n                        a.idlang = ''".$lang."''";\r\n\r\n    $db->query($sql);\r\n\r\n    while ($db->next_record()) {\r\n\r\n        $catartid = $db->f(''idcatart'');\r\n        $title = $db->f(''title'');\r\n\r\n        if ($cms_idcatart != $catartid) {\r\n            echo ''<option value="''.$catartid.''">&nbsp;''.$title.''</option>'';\r\n        } else {\r\n            echo ''<option selected="selected" value="''.$catartid.''">&nbsp;''.$title.''</option>'';\r\n        }\r\n\r\n    }\r\n}\r\n\r\necho ''</select>&nbsp;<input type="image" src="images/submit.gif">'';\r\necho ''</td></tr></table>'';\r\n?><?php', '<?php\r\n/**\r\n* $RCSfile$\r\n*\r\n* Description: Article Include Output\r\n*\r\n* @version 1.0.0\r\n* @author Willi Man\r\n* @copyright four for business AG <www.4fb.de>\r\n*\r\n* {@internal\r\n* created 2003-12-18\r\n* modified 2004-01-02\r\n* modified 2005-08-05 Andreas Lindner\r\n* }}\r\n*/\r\n\r\n#Get current settings\r\n$cms_idcat    = "CMS_VALUE[1]";\r\n$cms_idcatart = "CMS_VALUE[2]";\r\n\r\n$bDebug = false;\r\n\r\n#Check data\r\n$cms_idcat    = (int)$cms_idcat;\r\n$cms_idcatart = (int)$cms_idcatart;\r\n\r\nif ($bDebug) {\r\n   echo "<pre> cat $cms_idcat catart $cms_idcatart</pre>";\r\n}\r\n\r\nif ($cms_idcat >= 0 && $cms_idcatart >= 0)\r\n{\r\n   $bArticleAvailable = false;\r\n   # Get idcat, idcatart, idart and lastmodified from the database\r\n   $sql = "SELECT A.idart AS idart, A.idcat AS idcat, A.createcode AS createcode,\r\n                  A.idcatart AS idcatart, B.lastmodified AS lastmodified\r\n           FROM ".$cfg["tab"]["cat_art"]." AS A, ".$cfg["tab"]["art_lang"]." AS B\r\n           WHERE\r\n            A.idart = B.idart AND\r\n            B.online = 1 AND ";\r\n\r\n   if ($cms_idcatart == 0)\r\n   {\r\n      $sql .= "A.idcat = ''" . $cms_idcat . "'' ORDER BY B.lastmodified DESC"; # Only idcat specified, get latest article of category\r\n   } else {\r\n      $sql .= "A.idcatart = ''" . $cms_idcatart . "''"; # Article specified\r\n   }\r\n\r\n   if ($bDebug)\r\n   {\r\n      echo "<pre>";\r\n      print_r($sql);\r\n      echo "</pre>";\r\n   }\r\n   $db->query($sql);\r\n\r\n   if ($db->next_record())\r\n   { \r\n      $bArticleAvailable = true; \r\n      $iIDCatArt   = $db->f("idcatart"); \r\n      $iIDCat      = $db->f("idcat"); \r\n      $iIDArt      = $db->f("idart"); \r\n      $iCreateCode = $db->f("createcode"); \r\n      $sModified   = $db->f("lastmodified"); \r\n   } \r\n\r\n   $db->free();\r\n\r\n   # Check if category is online or protected\r\n   $sql = "SELECT public, visible \r\n           FROM " . $cfg["tab"]["cat_lang"] . " \r\n           WHERE idcat = ''" . $iIDCat . "'' AND idlang = ''" . $lang . "''";\r\n   \r\n   if ($bDebug)\r\n   {\r\n      echo "<pre>";\r\n      print_r($sql);\r\n      echo "</pre>";\r\n   }\r\n   \r\n   $db->query($sql);\r\n   $db->next_record();\r\n\r\n   $iPublic  = $db->f("public");\r\n   $iVisible = $db->f("visible"); \r\n\r\n   $db->free(); \r\n\r\n   # Check if article is online\r\n   # Not needed anymore, as only online articles are used\r\n   /* $sql = "SELECT online FROM " . $cfg["tab"]["art_lang"] . "\r\n           WHERE idart = ''" . $cms_artid . "'' AND idlang = ''" . $lang . "''";\r\n\r\n   if ($bDebug)\r\n   {\r\n      echo "<pre>";\r\n      print_r($sql);\r\n      echo "</pre>";\r\n   }\r\n   $db->query($sql);\r\n   $db->next_record();\r\n\r\n   $online = $db->f("online");\r\n\r\n   $db->free(); */\r\n\r\n   # If the article is online and the according category is not protected and visible, include the article\r\n   if ($bArticleAvailable && $iPublic == 1 && $iVisible == 1) \r\n   { \r\n      # Check, if code creation is necessary \r\n      # Note, that createcode may be 0, but no code is available (all code for other languages will be deleted in \r\n      # front_content, if code for one language will be created). This "bug" may be fixed in future releases. \r\n      if ($iCreateCode == 0) \r\n      { \r\n         $sql = "SELECT count(*) AS CodeCount FROM " . $cfg["tab"]["code"] . " \r\n                 WHERE idcatart = ''" . $iIDCatArt . "'' AND idlang = ''" . $lang . "''";\r\n         \r\n         if ($bDebug)\r\n         {\r\n            echo "<pre>";\r\n            print_r($sql);\r\n            echo "</pre>";\r\n         }\r\n\r\n         $db->query($sql);\r\n         $db->next_record();\r\n\r\n         if ($db->f("CodeCount") == 0) {\r\n            $iCreateCode = 1;\r\n         }\r\n         $db->free();\r\n      }\r\n\r\n      # Create code if necessary\r\n      if ($iCreateCode == 1)\r\n      {\r\n         cInclude(''includes'', ''functions.con.php'');\r\n         cInclude(''includes'', ''functions.tpl.php'');\r\n         cInclude(''includes'', ''functions.mod.php'');\r\n\r\n         conGenerateCode($iIDCat, $iIDArt, $lang, $client);\r\n      } \r\n\r\n      # Get code from database and execute it \r\n      $sql = "SELECT code FROM " . $cfg["tab"]["code"] . " \r\n              WHERE idcatart = ''" . $iIDCatArt . "'' AND idlang = ''" . $lang . "''";\r\n\r\n      if ($bDebug)\r\n      {\r\n         echo "<pre>"; \r\n         print_r($sql); \r\n         echo "</pre>"; \r\n      } \r\n\r\n      $db->query($sql); \r\n\r\n      if ($db->next_record()) \r\n      {\r\n         $sCode = stripslashes($db->f("code")); \r\n         $db->free(); \r\n\r\n         ob_start();\r\n         eval("?>\r\n".$sCode."\r\n<?php\r\n");\r\n         $sCode = ob_get_contents();\r\n\r\n         # Clean buffer\r\n         ob_end_clean();\r\n\r\n         $iStartPos = strpos($sCode, "<!--start:content-->");\r\n         $iEndPos   = strpos($sCode, "<!--end:content-->");\r\n         $iDiffLen  = $iEndPos - $iStartPos;\r\n\r\n         $sCode = substr($sCode, $iStartPos, $iDiffLen);\r\n\r\n         echo $sCode;\r\n      } else {\r\n         echo "<!-- ERROR in module Article Include<pre>no code created for article to include!<br>idcat $cms_catid, idart $cms_artid, idlang $lang, idclient $client</pre>-->";\r\n      }\r\n   }\r\n}\r\n?>\r\n', '', 0, NULL, NULL, '48a365b4ce1e322a55ae9017f3daf0c0', '2008-04-14 15:49:41', '2013-09-14 14:53:56');
INSERT INTO `!PREFIX!_mod` VALUES (4, 1, 'Kontakt', 'Content', 'none', 'Kontaktformular anzeigen und eingegebene Daten per eMail verschicken\r\n\r\nAutor:   Spider IT Deutschland - Rene Mansveld (www.Spider-IT.de)\r\nVersion: 1.1 (2013-10-07)\r\nBase:    Modul "Kontakt" by Andreas Lindner (4fb)\r\n\r\nChanges:\r\n2013-10-07 - V.1.1:\r\n - NEW: Zeitsteuerung als Spamfilter\r\n - NEW: Hinweise werden in eine Box angezeigt\r\n - NEW: Mails enthalten eine Klartextvariante zusaetzlich zur HTML-Variante\r\n\r\n2005-08-12 - V.1.0:\r\n - Original release by Andreas Lindner (4fb)', NULL, '?><?php\r\n/**\r\n* $RCSfile$\r\n*\r\n* Description: Contact form. Module "Input".\r\n*\r\n* @version 1.0.0\r\n* @author Andreas Lindner\r\n* @copyright four for business AG <www.4fb.de>\r\n*\r\n* {@internal\r\n*   created 2005-08-12\r\n*   modified for drugCMS 2013-10-07: Rene Mansveld - Spider IT Deutschland (www.Spider-IT.de)\r\n* }\r\n*/\r\n?>\r\n\r\n<table border="0">\r\n    <tr>\r\n        <td style="width: 40%;"><?php echo mi18n("Absender EMail");?></td>\r\n        <td style="width: 60%;"><input type="text" name="<?php echo "CMS_VAR[0]";?>" value="<?php echo "CMS_VALUE[0]"; ?>" style="width: 400px;"></td>\r\n    </tr>\r\n    <tr>\r\n        <td><?php echo mi18n("Absender Name");?></td>\r\n        <td><input type="text" name="<?php echo "CMS_VAR[2]";?>" value="<?php echo "CMS_VALUE[2]"; ?>" style="width: 400px;"></td>\r\n    </tr>\r\n    <tr>\r\n        <td><?php echo mi18n("Empf&auml;nger EMail");?></td>\r\n        <td><input type="text" name="<?php echo "CMS_VAR[1]";?>" value="<?php echo "CMS_VALUE[1]"; ?>" style="width: 400px;"></td>\r\n    </tr>\r\n    <tr>\r\n        <td><?php echo mi18n("Betreff");?></td>\r\n        <td><input type="text" name="<?php echo "CMS_VAR[3]";?>" value="<?php echo "CMS_VALUE[3]"; ?>" style="width: 400px;"></td>\r\n    </tr>\r\n    <tr>\r\n        <td colspan="2">\r\n            <div style="padding: 4px 6px; background-color: #FFD; border: 1px solid #AAA; border-radius: 7px;">\r\n                <?php echo mi18n("Die Angaben zum Mailversand werden in den Mandanteneinstellungen gemacht"); ?>:<br />\r\n                &nbsp;- email - sender-name<br />\r\n                &nbsp;- email - sender-email<br />\r\n                &nbsp;- email - mailer - <strong>mail</strong><br />\r\n                &nbsp;- email - smtp-server<br />\r\n                &nbsp;- email - smtp-login<br />\r\n                &nbsp;- email - smtp-password<br />\r\n                &nbsp;- email - smtp-port - <strong>25</strong><br />\r\n                <?php echo mi18n("Die hier genannten Werte sind die Standardwerte.<br />Oben gemachten Angaben &uuml;berschreiben die Mandanteneinstellungen f&uuml;r diesen Bereich (Kategorie / Artikel).<br />Verf&uuml;gbare Mailer sind:"); ?> mail, qmail, sendmail, smtp.\r\n            </div>\r\n        </td>\r\n    </tr>\r\n</table>\r\n<?php', '<?php\r\n/**\r\n* $RCSfile$\r\n*\r\n* Description: Contact form. Module "Output".\r\n*\r\n* @version 1.0.0\r\n* @author Andreas Lindner\r\n* @copyright four for business AG <www.4fb.de>\r\n*\r\n* {@internal\r\n*   created 2005-08-12\r\n*   modified for drugCMS 2013-10-07: Rene Mansveld - Spider IT Deutschland (www.Spider-IT.de)\r\n* }\r\n*/\r\n\r\n# Includes\r\ncInclude(''frontend'', ''includes/spider-it.functions.inc.php'');\r\n\r\n# Settings\r\n\r\n# Execution\r\n$bOK = false;\r\n$sMsg = '''';\r\n\r\nif ((isset ($_POST[''send''])) && ($_POST[''send''] == 1)) {\r\n    # Form has been sent\r\n\r\n    # Check user input\r\n    $sPre = ''<br />&nbsp; - '';\r\n    if (strlen($_POST[''Vorname'']) == 0) {\r\n        $sMsg .= $sPre . mi18n("Bitte geben Sie Ihr Vorname ein!");\r\n    }\r\n    if (strlen($_POST[''Nachname'']) == 0) {\r\n        $sMsg .= $sPre . mi18n("Bitte geben Sie Ihr Name ein!");\r\n    }\r\n    if (strlen($_POST[''Telefon'']) == 0) {\r\n        $sMsg .= $sPre . mi18n("Bitte geben Sie Ihre Telefonnummer ein!");\r\n    }\r\n    if (strlen($_POST[''EMail'']) == 0) {\r\n        $sMsg .= $sPre . mi18n("Bitte geben Sie Ihre E-Mail-Adresse ein!");\r\n    }\r\n    if (strlen($_POST[''Anliegen'']) == 0) {\r\n        $sMsg .= $sPre . mi18n("Bitte geben Sie Ihr Anliegen ein!");\r\n    }\r\n\r\n    if (strlen($sMsg)) {\r\n        # Errors have been found\r\n        $sMsg = ''<p class="error"><strong>'' . mi18n("Die folgenden Fehler wurden gefunden:") . ''</strong>'' . $sMsg . ''</p>'';\r\n    } else {\r\n        # Process the form data only if it was sent after at least 15 seconds (bots are faster) and at most 60 minutes (bots cache the page)\r\n        if (($_POST[''tmref''] < strtotime(''-15 seconds'')) && ($_POST[''tmref''] > strtotime(''-60 minutes''))) {\r\n            # No errors, create and send mail\r\n            $sMailBody = ''<html><head></head><body bgcolor="#ffffff"><table cellspacing="0" cellpadding="2" border="0">'';\r\n\r\n            if (is_array($_POST)) {\r\n                foreach ($_POST as $key => $value) {\r\n                    if (($key != ''send'') && ($key != ''tmref'')) {\r\n                        $sMailBody .= "<tr><td>$key&nbsp;</td><td>$value</td></tr>";\r\n                    }\r\n                }\r\n            }\r\n\r\n            $sMailBody .= ''</table></body></html>'';\r\n            #sitSendHtmlMail($html, $subject, $receipients, $attachments = '''', $sname = '''', $smail = '''', $mailer = '''', $sserver = '''', $slogin = '''', $spass = '''', $sport = '''')\r\n            $bOK = sitSendHtmlMail($sMailBody, "CMS_VALUE[3]", array(''name'' => '''', ''email'' => "CMS_VALUE[1]"), '''', "CMS_VALUE[2]", "CMS_VALUE[0]");\r\n            if($bOK) {\r\n                # Display message after mail is sent\r\n                echo ''<p class="info">'' . mi18n("Ihr Anliegen wurde &uuml;bermittelt. Vielen Dank!") . ''</p>'';\r\n            } else {\r\n                $sMsg = ''<p class="error">'' . mi18n("Ihr Anliegen konnte aufgrund eines Timeout nicht &uuml;bermittelt werden. Bitte versuchen Sie es sp&auml;ter noch einmal.") . ''</p>'';\r\n            }\r\n        }\r\n    }\r\n}\r\nif (!$bOK) {\r\n    # Create contact form\r\n    $oTpl = new Template();\r\n    \r\n    $oTpl->set(''s'', ''MESSAGE'', $sMsg);\r\n    $oTpl->set("s", "FORM_ACTION", $sess->url(''front_content.php?idcat='' . $idcat . ''&amp;idart='' . $idart));\r\n    $oTpl->set(''s'', ''NOSPAM'', time());\r\n    $oTpl->set("s", "ANREDE", mi18n("Anrede"));\r\n    $oTpl->set("s", "ANREDE_OPTION1", mi18n("Herr"));\r\n    $oTpl->set("s", "ANREDE_OPTION2", mi18n("Frau"));\r\n    $oTpl->set("s", "NACHNAME", mi18n("Name"));\r\n    $oTpl->set("s", "VORNAME", mi18n("Vorname"));\r\n    $oTpl->set("s", "FIRMA", mi18n("Firma"));\r\n    $oTpl->set("s", "STRASSE", mi18n("Stra&szlig;e/Nr."));\r\n    $oTpl->set("s", "PLZORT", mi18n("PLZ/Ort"));\r\n    $oTpl->set("s", "TELEFON", mi18n("Telefon"));\r\n    $oTpl->set("s", "EMAIL", mi18n("eMail"));\r\n    $oTpl->set("s", "ANLIEGEN", mi18n("Nachricht"));\r\n    $oTpl->set("s", "PFLICHTFELDER", mi18n("Pflichtfelder"));\r\n    $oTpl->set("s", "ABSCHICKEN", mi18n("Abschicken"));\r\n    $oTpl->set("s", "LOESCHEN", mi18n("L&ouml;schen"));\r\n    \r\n    $oTpl->set("s", "ANREDE_OPTION1_DATEN", (($_POST[''Anrede''] == "Herr") ? '' checked="checked"'' : ''''));\r\n    $oTpl->set("s", "ANREDE_OPTION2_DATEN", (($_POST[''Anrede''] == "Frau") ? '' checked="checked"'' : ''''));\r\n    $oTpl->set("s", "NACHNAME_DATEN", $_POST[''Nachname'']);\r\n    $oTpl->set("s", "VORNAME_DATEN", $_POST[''Vorname'']);\r\n    $oTpl->set("s", "FIRMA_DATEN", $_POST[''Firma'']);\r\n    $oTpl->set("s", "STRASSE_DATEN", $_POST[''Strasse'']);\r\n    $oTpl->set("s", "PLZORT_DATEN", $_POST[''PLZORT'']);\r\n    $oTpl->set("s", "TELEFON_DATEN", $_POST[''Telefon'']);\r\n    $oTpl->set("s", "EMAIL_DATEN", $_POST[''EMail'']);\r\n    $oTpl->set("s", "ANLIEGEN_DATEN", $_POST[''Anliegen'']);\r\n    \r\n    $oTpl->generate(''templates/kontaktformular.html'');\r\n}\r\n?>', '', 0, NULL, NULL, '48a365b4ce1e322a55ae9017f3daf0c0', '2008-04-14 15:52:45', '2014-01-05 12:10:16');
INSERT INTO `!PREFIX!_mod` VALUES (5, 1, 'Contenido_Header', 'Content', 'none', 'Display HTML Comment with Infos about Contenido and the Sample Client.', NULL, '', '<?php\r\n/**\r\n* $RCSfile$\r\n*\r\n* Description: Display HTML Comment with Infos about Contenido and the Sample Client.\r\n*\r\n* @version 1.0.0\r\n* @author Rudi Bieller\r\n* @copyright four for business AG <www.4fb.de>\r\n*\r\n* {@internal\r\n* created 2008-04-07\r\n* }}\r\n*/\r\n\r\nif (!isset($tpl) || !is_object($tpl) || strtolower(get_class($tpl)) != ''template'') {\r\n    $tpl = new Template();\r\n}\r\n$tpl->reset();\r\n$tpl->generate(''templates/contenido_header.html'');\r\n?>', '', 0, NULL, NULL, '48a365b4ce1e322a55ae9017f3daf0c0', '2008-04-14 15:53:21', '2013-09-14 14:54:27');
INSERT INTO `!PREFIX!_mod` VALUES (6, 1, 'Footnotes', 'Content', 'none', 'Display Footnotes at bottom of page.', NULL, '', '<?php\r\n$oTpl = new Template();\r\n\r\n$oTpl->set(''s'', ''LEGAL_NOTICE'', mi18n("All rights reserved."));\r\n\r\n$oTpl->generate(''templates/footnotes.html'');\r\n?>', '', 0, NULL, NULL, '48a365b4ce1e322a55ae9017f3daf0c0', '2008-04-14 15:53:44', '2013-10-06 16:31:51');
INSERT INTO `!PREFIX!_mod` VALUES (7, 1, 'Header', 'Content', 'none', 'Display Header with Contenido Logo, an image and the current (navigation-) location.', NULL, '', '<?php\r\n/**\r\n* $RCSfile$\r\n*\r\n* Description: Display Header with Contenido Logo, an image and the current (navigation-) location.\r\n* If no image is selected, the default one will be used.\r\n*\r\n* @version 1.0.0\r\n* @author Rudi Bieller\r\n* @copyright four for business AG <www.4fb.de>\r\n*\r\n* {@internal\r\n* created 2008-04-07\r\n* }}\r\n*/\r\n\r\nif (!isset($tpl) || !is_object($tpl)) {\r\n    $tpl = new Template();\r\n}\r\n\r\n// get start idcat\r\n$iIdcatStart = (int) getEffectiveSetting(''navigation'', ''idcat-home'', ''1'');\r\n\r\ntry {\r\n    // get headline\r\n    $oConCat = new Contenido_Category($db, $cfg);\r\n    $oConCat->load($idcat, true, $lang);\r\n    $sImgEdit = "CMS_IMGDESCR[1]";\r\n    $sImg = "CMS_IMG[1]";\r\n    \r\n    $sHeadline = $iIdcatStart != intval($idcat) \r\n                    ? $oConCat->getCategoryLanguage()->getName() \r\n                    : mi18n("Willkommen!");\r\n    $sCssStyle = '''';\r\n    if ($contenido && $edit) {\r\n        echo ''<div id="modHeaderImgEdit">''.$sImgEdit.''</div>'';\r\n    }\r\n    if ($sImg != '''') {\r\n        $sCssStyle = '' style="background-image:url(''.$sImg.'');"'';\r\n    }\r\n    $tpl->reset();\r\n    $tpl->set(''s'', ''css-style'', $sCssStyle);\r\n    $tpl->set(''s'', ''url'', ''front_content.php'');\r\n    $tpl->set(''s'', ''title'', mi18n("Zur Contenido Homepage"));\r\n    $tpl->set(''s'', ''headline'', $sHeadline);\r\n    $tpl->generate(''templates/header.html'');\r\n} catch (InvalidArgumentException $eI) {\r\n    echo ''Some error occured: '' . $eI->getMessage() . '': '' . $eI->getFile() . '' at line ''.$eI->getLine() . '' (''.$eI->getTraceAsString().'')'';\r\n} catch (Exception $e) {\r\n    echo ''Some error occured: '' . $e->getMessage() . '': '' . $e->getFile() . '' at line ''.$e->getLine() . '' (''.$e->getTraceAsString().'')'';\r\n}\r\n?>', '', 0, NULL, NULL, '48a365b4ce1e322a55ae9017f3daf0c0', '2008-04-14 15:53:58', '2013-09-14 14:54:50');
INSERT INTO `!PREFIX!_mod` VALUES (8, 1, 'Headline', 'Content', 'none', 'Output standard h1 headline', NULL, '', '<?php\r\n/**\r\n* $RCSfile$\r\n*\r\n* Description: Output standard h1 headline\r\n*\r\n* @version 1.0.0\r\n* @author Rudi Bieller\r\n* @copyright four for business AG <www.4fb.de>\r\n*\r\n* {@internal\r\n* created 2008-04-07\r\n* modified 2008-11-13, Timo Trautman - fixed XHTML validation error, when module displays empty h1 tag\r\n* }}\r\n*/\r\n\r\nif (!isset($tpl) || !is_object($tpl)) {\r\n    $tpl = new Template();\r\n}\r\n\r\n$sText = "CMS_HTMLHEAD[1]";\r\n\r\n$tpl->reset();\r\nif ($contenido && $edit) {\r\n    $tpl->set(''s'', ''text'', $sText);\r\n    $tpl->generate(''templates/headline_h1.html'');\r\n} else {\r\n    if ($sText != '''') {\r\n        $tpl->set(''s'', ''text'', strip_tags($sText));\r\n        $tpl->generate(''templates/headline_h1.html'');\r\n    }\r\n}\r\n\r\n?>', '', 0, NULL, NULL, '48a365b4ce1e322a55ae9017f3daf0c0', '2008-04-14 15:54:15', '2013-09-14 14:55:09');
INSERT INTO `!PREFIX!_mod` VALUES (9, 1, 'Illustration', 'Content', 'none', 'Illustration (image) with configurable position (height).\r\nThe selected image gets scaled (up or down) to fit the set width, and can then be moved in a viewport along the Y-axis to get the optimal part for the output.\r\n\r\nAutor:    Spider IT Deutschland - Rene Mansveld (www.Spider-IT.de)\r\nVersion:  1.1 (2013-09-17)\r\n\r\nChanges:\r\n2013-09-17 - V.1.1:\r\n - The output image gets cropped to the needed size\r\n\r\n2013-04-16 - V.1.0:\r\n - Initial release', NULL, '?>\r\n<table>\r\n    <tr>\r\n        <td style="width: 40%;"><?php echo mi18n("Sizes (W x H)"); ?></td>\r\n        <td style="width: 60%;">\r\n            <input type="text" name="<?php echo "CMS_VAR[0]"; ?>" value="<?php echo "CMS_VALUE[0]"; ?>" style="width: 50px; text-align: right;" />\r\n            x\r\n            <input type="text" name="<?php echo "CMS_VAR[1]"; ?>" value="<?php echo "CMS_VALUE[1]"; ?>" style="width: 50px; text-align: right;" />\r\n            px\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td colspan="2">\r\n            <div style="padding: 4px 6px; background-color: #FFD; border: 1px solid #AAA; border-radius: 7px;">\r\n                <?php echo mi18n("These settings can also be made in the client settings"); ?>:<br />\r\n                &nbsp;- illustration - width - <strong>800</strong><br />\r\n                &nbsp;- illustration - height - <strong>300</strong><br />\r\n                <?php echo mi18n("The here mentioned values are the default values.<br />The settings made above overwrite the client settings for this area (category / article)."); ?>\r\n            </div>\r\n        </td>\r\n    </tr>\r\n</table>\r\n<?php', '<?php\r\n# Includes\r\ncInclude(''frontend'', ''includes/spider-it.functions.inc.php'');\r\n\r\n# Settings\r\n$iLeft      = 0;\r\n$iTop       = intval(((isset($_POST[''HeaderImageTop''])) ? $_POST[''HeaderImageTop''] : "CMS_TEXT[1000]"));\r\n$iWidth     = intval(((strlen("CMS_VALUE[0]")) ? "CMS_VALUE[0]" : getEffectiveSetting(''illustration'', ''width'', 800)));\r\n$iHeight    = intval(((strlen("CMS_VALUE[1]")) ? "CMS_VALUE[1]" : getEffectiveSetting(''illustration'', ''height'', 300)));\r\n\r\n$sImg = "CMS_IMG[0]";\r\nif (is_numeric($sImg)) {\r\n    # The idupl was saved, get the image path\r\n    $sql = ''SELECT dirname, filename\r\n            FROM '' . $cfg[''tab''][''upl''] . ''\r\n            WHERE (idupl='' . $sImg . '')'';\r\n    $db->query($sql);\r\n    if ($db->next_record()) {\r\n        $sImg = $cfgClient[$client][''upl''][''path''] . $db->f(''dirname'') . $db->f(''filename'');\r\n    } else {\r\n        unset($sImg);\r\n    }\r\n}\r\n\r\n# Save positioning if submitted\r\nif (isset($_POST[''HeaderImageTop''])) {\r\n    # Delete the old frontend image\r\n    $sBackendImage = sitImgScale(str_replace(array($cfgClient[$client][''path''][''htmlpath''], $cfgClient[$client][''path''][''frontend'']), '''', $sImg), $iWidth, 10000, false, true, mt_rand(60, 6000), true, 75, false, false, ''FFFFFF'');\r\n    $md5 = capiImgScaleGetMD5CacheFile(str_replace(array($cfgClient[$client][''path''][''htmlpath''], $cfgClient[$client][''path''][''frontend'']), '''', $sBackendImage), $iWidth, $iHeight, true, false);\r\n    unlink($cfgClient[''path''][''frontend''] . ''cache/'' . $md5 . ''.png'');\r\n    # Save the value\r\n    conSaveContentEntry($idartlang, ''CMS_TEXT'', 1000, $_POST[''HeaderImageTop'']);\r\n}\r\n\r\n# Execute\r\nif ($edit) {\r\n?>\r\n    <script type="text/javascript">\r\n    //<![CDATA[\r\n        function moveImage(y) {\r\n            var obj = document.getElementById(''HeaderImage'');\r\n            var top = Number(obj.style.marginTop.substr(0, (obj.style.marginTop.length -2)));\r\n            top = (top + y);\r\n            if (top < -(obj.height - <?php echo $iHeight; ?>)) {\r\n                top = -(obj.height - <?php echo $iHeight; ?>);\r\n            }\r\n            if (top > 0) {\r\n                top = 0;\r\n            }\r\n            obj.style.marginTop = top + ''px'';\r\n        }\r\n        function savePosition() {\r\n            var f = document.forms[''editcontent''];\r\n            var s = document.getElementById(''HeaderImage'').style.marginTop;\r\n            var t = document.getElementById(''HeaderImageTop'').value;\r\n            var c = document.createElement(''input'');\r\n            c.type = ''hidden'';\r\n            c.name = ''HeaderImageTop'';\r\n            c.value = s;\r\n            f.appendChild(c);\r\n            var c = document.createElement(''input'');\r\n            c.type = ''hidden'';\r\n            c.name = ''HeaderImageOldTop'';\r\n            c.value = t;\r\n            f.appendChild(c);\r\n            f.submit();\r\n        }\r\n    //]]>\r\n    </script>\r\n<?php\r\n}\r\nif ((strlen($sImg)) || ($edit)) {\r\n    # Remove unnessecary path information from the image path\r\n    $sImg = str_replace(array($cfgClient[$client][''path''][''htmlpath''], $cfgClient[$client][''path''][''frontend'']), '''', $sImg);\r\n    # Scale the image to the desired width\r\n    $sImg = sitImgScale($sImg, $iWidth, 10000, false, true, mt_rand(60, 6000), true, 75, false, false, ''FFFFFF'');\r\n    if ($edit) {\r\n        # Create a viewport for the image\r\n?>\r\n    <div class="illustration" style="height: <?php echo $iHeight; ?>px; overflow: hidden; background-color: rgba(128, 128, 128, 0.2);">\r\n<?php\r\n        # Output the image navigation and then the image at the desired position\r\n?>\r\n        <div style="position: absolute; margin: 0px 0px 0px <?php echo $iWidth; ?>px; width: 16px; height: <?php echo $iHeight; ?>px; line-height: 14px; background-color: rgba(255, 128, 0, 0.3);">\r\n            <div>\r\n                <div style="margin: 0px; padding: 0px; height: 16px; overflow: hidden;"><?php echo "CMS_IMGDESCR[0]"; ?></div>\r\n                <input type="button" name="largeUp" value="&uarr;&uarr;" style="margin: 0px; padding: 0px; width: 16px; height: 16px; font-size: 8px; color: #000; background-color: #F80; border: 0px none; border-radius: 2px; cursor: pointer;" onclick="moveImage(10)" /><br />\r\n                <input type="button" name="smallUp" value="&uarr;" style="margin: 0px; padding: 0px; width: 16px; height: 16px; font-size: 8px; color: #000; background-color: #F80; border: 0px none; border-radius: 2px; cursor: pointer;" onclick="moveImage(1)" /><br />\r\n            </div>\r\n            <div style="margin-top: <?php echo ((($iHeight - 101) < 0) ? 0 : ($iHeight - 101)); ?>px;">\r\n                <input type="button" name="largeDown" value="&darr;" style="margin: 0px; padding: 0px; width: 16px; height: 16px; font-size: 8px; color: #000; background-color: #F80; border: 0px none; border-radius: 2px; cursor: pointer;" onclick="moveImage(-1)" /><br />\r\n                <input type="button" name="smallDown" value="&darr;&darr;" style="margin: 0px 0px 1px 0px; padding: 0px; width: 16px; height: 16px; font-size: 8px; color: #000; background-color: #F80; border: 0px none; border-radius: 2px; cursor: pointer;" onclick="moveImage(-10)" /><br />\r\n                <input type="image" name="savePos" src="<?php echo $cfg[''path''][''contenido_fullhtml'']; ?>images/but_ok.gif" onclick="savePosition()" />\r\n            </div>\r\n        </div>\r\n        <img id="HeaderImage" src="<?php echo $sImg; ?>" alt="" style="margin-top: <?php echo $iTop; ?>px;" />\r\n        <input id="HeaderImageTop" type="hidden" value="<?php echo $iTop; ?>" />\r\n<?php\r\n        # Close the viewport\r\n?>\r\n    </div>\r\n<?php\r\n    } else {\r\n        # Remove unnessecary path information from the image path\r\n        $sImg = str_replace(array($cfgClient[$client][''path''][''htmlpath''], $cfgClient[$client][''path''][''frontend'']), '''', $sImg);\r\n        # Crop it to the desired height from the desired position\r\n        $sImg = sitImgScale($sImg, $iWidth, $iHeight, true, false, mt_rand(60, 6000), true, 75, false, false, ''FFFFFF'', 0, abs($iTop));\r\n        # Output the cropped version of the image\r\n?>\r\n    <div class="illustration">\r\n        <img id="HeaderImage" src="<?php echo $sImg; ?>" alt="" />\r\n    </div>\r\n<?php\r\n    }\r\n}\r\n?>', '', 0, NULL, NULL, '48a365b4ce1e322a55ae9017f3daf0c0', '2013-09-17 11:25:24', '2013-10-09 11:44:47');
INSERT INTO `!PREFIX!_mod` VALUES (10, 1, 'Login_Form', 'Content', 'none', 'Display login-form.', NULL, '', '<?php\r\n/**\r\n* $RCSfile$\r\n*\r\n* Description: Display login form\r\n*\r\n* @version 1.0.0\r\n* @author Rudi Bieller\r\n* @copyright four for business AG <www.4fb.de>\r\n*\r\n* {@internal\r\n* created 2008-04-07\r\n* }}\r\n*/\r\n\r\nif (!isset($tpl) || !is_object($tpl)) {\r\n    $tpl = new Template();\r\n}\r\n\r\n$tpl->reset();\r\n\r\nif ($auth->auth["uid"] == "nobody") {\r\n    $sTargetIdcat = getEffectiveSetting(''login'', ''idcat'', ''1'');\r\n    $sTargetIdart = getEffectiveSetting(''login'', ''idart'', ''1'');\r\n    $sFormAction = ''front_content.php?idcat=''.$sTargetIdcat.''&amp;idart=''.$sTargetIdart;\r\n    \r\n    $tpl->set(''s'', ''headline'', mi18n("Geschlossener Bereich Login"));\r\n    $tpl->set(''s'', ''form_action'', $sFormAction);\r\n    $tpl->set(''s'', ''label_name'', mi18n("name"));\r\n    $tpl->set(''s'', ''label_pass'', mi18n("pass"));\r\n    $tpl->set(''s'', ''label_login'', mi18n("einloggen"));\r\n    $tpl->generate(''templates/login_form.html'');\r\n} else {\r\n    try {\r\n        $oConCat = new Contenido_Category($db, $cfg);\r\n        $oConCat->load($idcat, true, $lang);\r\n        $bCatIsPublic = ($oConCat->getCategoryLanguage()->getVisible() == 1 && $oConCat->getCategoryLanguage()->getPublic() == 1) \r\n                        ? true : false;\r\n    } catch (Exception $e) {\r\n        echo $e->getMessage();\r\n    }\r\n    $oFeUserCollection = new FrontendUserCollection();\r\n    $oFeUser = $oFeUserCollection->loadItem($auth->auth["uid"]);\r\n    $sText = str_replace(''[uname]'', $oFeUser->get(''username''), mi18n("Willkommen <strong>[uname]</strong>, sch?n, dass Sie wieder bei uns vorbeischauen."));\r\n    if ($bCatIsPublic === true) {\r\n        $sUrl = ''front_content.php?idcat=''.$idcat.''&amp;idart=''.$idart.''&logout=true'';\r\n    } else {\r\n        $iIdcatHome = (int) getEffectiveSetting(''navigation'', ''idcat-home'', ''1'');\r\n        $sUrl = ''front_content.php?idcat=''.$iIdcatHome.''&amp;logout=true'';\r\n    }\r\n    $tpl->set(''s'', ''headline'', mi18n("Geschlossener Bereich Logout"));\r\n    $tpl->set(''s'', ''text'', $sText);\r\n    $tpl->set(''s'', ''url'', $sUrl);\r\n    $tpl->set(''s'', ''label_logout'', mi18n("ausloggen"));\r\n    $tpl->generate(''templates/login_form_loggedin.html'');\r\n}\r\n?>', '', 0, NULL, NULL, '48a365b4ce1e322a55ae9017f3daf0c0', '2008-04-14 15:55:09', '2013-09-14 14:55:19');
INSERT INTO `!PREFIX!_mod` VALUES (11, 1, 'Logo_Bottom', 'Content', 'none', 'Display logo on bottom of page.', NULL, '', '<?php\r\n/**\r\n* $RCSfile$\r\n*\r\n* Description: Display Logo on bottom of page\r\n*\r\n* @version 1.0.0\r\n* @author Rudi Bieller\r\n* @copyright four for business AG <www.4fb.de>\r\n*\r\n* {@internal\r\n* created 2008-04-07\r\n* }}\r\n*/\r\nif (!isset($tpl) || !is_object($tpl)) {\r\n    $tpl = new Template();\r\n}\r\n\r\n\r\n$tpl->reset();\r\n$tpl->generate(''templates/logo_bottom.html'');\r\n?>', '', 0, NULL, NULL, '48a365b4ce1e322a55ae9017f3daf0c0', '2008-04-14 15:55:27', '2013-09-14 14:55:29');
INSERT INTO `!PREFIX!_mod` VALUES (12, 1, 'Motto', 'Header', 'none', 'Displays the logo with a descriptive text\r\n\r\nAuthor:  Spider IT Deutschland - Rene Mansveld (www.Spider-IT.de)\r\nVersion: 1.0 (2013-09-04)', NULL, '', '<?php echo mi18n("The Content Management System with addictive potential"); ?>', '', 0, NULL, NULL, '48a365b4ce1e322a55ae9017f3daf0c0', '2013-09-14 18:29:08', '2013-09-14 18:47:12');
INSERT INTO `!PREFIX!_mod` VALUES (13, 1, 'Navigation_Breadcrumb', 'Navigation', 'none', 'Display a breadcrumb navigation.', NULL, '', '<?php\r\n/**\r\n* $RCSfile$\r\n*\r\n* Description: Build a breadcrumb navigation \r\n* starting from top idcat (of given level) down to current idcat\r\n*\r\n* @version 1.0.0\r\n* @author Rudi Bieller\r\n* @copyright four for business AG <www.4fb.de>\r\n*\r\n* {@internal\r\n* created 2008-04-08\r\n* }}\r\n*/\r\n\r\ntry {\r\n    $oBreadcrumb = new Contenido_FrontendNavigation_Breadcrumb($db, $cfg, $client, $lang, $cfgClient);\r\n    $oBreadCategories = $oBreadcrumb->get($idcat, 1); // starting level in this case is 1, not 0\r\n    if ($oBreadCategories->count() > 0) {\r\n        foreach ($oBreadCategories as $oBreadCategory) {\r\n            // please remember, this is a sample - or a live application it''s better to use a template!\r\n            echo ''&gt; <a href="front_content.php?idcat=''.$oBreadCategory->getIdCat().''">''.\r\n                        $oBreadCategory->getCategoryLanguage()->getName().\r\n                ''</a> '';\r\n        }\r\n    }\r\n} catch(Exception $e) {\r\n    echo ''Shit happens: '' . $e->getMessage() . '': '' . $e->getFile() . '' at line ''.$e->getLine() . '' (''.$e->getTraceAsString().'')'';\r\n}\r\n?>', '', 0, NULL, NULL, '48a365b4ce1e322a55ae9017f3daf0c0', '2008-04-14 15:55:44', '2013-09-14 14:55:41');
INSERT INTO `!PREFIX!_mod` VALUES (14, 1, 'Navigation_Main', 'Navigation', 'none', 'Display main navigation on left side.', NULL, '', '<?php\r\n/**\r\n* $RCSfile$\r\n*\r\n* Description: \r\n* Main Navigation, displays Navigation from a starting idcat down to the max. level set.\r\n* For now (as of 2009-01-12) all subcategories are put inside one <ul> and are assigned css classes \r\n* to distinguish level depth, first/last and active item property.\r\n* \r\n* Module requires two client settings: \r\n* navigation_main_standard | start_idcat\r\n* navigation_main_standard | level_depth\r\n* \r\n* To modify the behaviour of the module (e.g. style of URL, CSS classes, ...), you need to edit Contenido_NavMain_Util::loopCats\r\n* @see {frontend}/includes/Util/Modules/Contenido_NavMain_Util.class.php\r\n*\r\n* @version 1.0.0\r\n* @author Rudi Bieller\r\n* @copyright four for business AG <www.4fb.de>\r\n*\r\n* {@internal\r\n* created 2009-01-12\r\n* }}\r\n*/\r\n\r\nif (!isset($db)) {\r\n    $db = new DB_Contenido();\r\n}\r\nif (!isset($tpl)) {\r\n    $tpl = new Template();\r\n}\r\n$tpl->reset();\r\n\r\ncInclude(''frontend'', ''includes/Util/Modules/Contenido_NavMain_Util.class.php'');\r\n\r\n$iStartIdcat = getEffectiveSetting(''navigation'', ''idcat-home'', 1);\r\n$iSelectedDepth = getEffectiveSetting(''navigation'', ''level-depth'', 3);\r\n\r\nif ($iStartIdcat > 0) {\r\n    $oFeNav = new Contenido_FrontendNavigation($db, $cfg, $client, $lang, $cfgClient);\r\n    $oFeNav->setAuth($auth);\r\n    $oFeNav->setRootCat($iStartIdcat);\r\n    $oSubCategories = $oFeNav->getSubCategories($iStartIdcat, true, true, 1);\r\n    // see if there are any subcategories to display\r\n    if ($oSubCategories->count() > 0) {\r\n        $aLevelInfo = array();\r\n        $aDepthInfo = array();\r\n        $aDepthInfo[0] = 0;\r\n        $aDepthInfo[1] = $iSelectedDepth;\r\n        foreach ($oSubCategories as $oSubCategory) {\r\n            Contenido_NavMain_Util::loopCats($oSubCategory, $oFeNav, $tpl, $cfg, $lang, $aLevelInfo, intval($idcat), $aDepthInfo);\r\n        }\r\n        $tpl->generate(''templates/navigation_standard.html'');\r\n    }\r\n} else {\r\n    echo ''<p>Navigation not configured correctly.</p>'';\r\n}\r\n?>', '', 0, NULL, NULL, '48a365b4ce1e322a55ae9017f3daf0c0', '2008-04-14 15:57:42', '2013-09-14 14:56:04');
INSERT INTO `!PREFIX!_mod` VALUES (15, 1, 'Navigation_Meta', 'Navigation', 'none', 'Display meta navigation on bottom of page.', NULL, '', '<?php\r\n/**\r\n* $RCSfile$\r\n*\r\n* Description: Meta Navigation on bottom of page\r\n*\r\n* @version 1.0.0\r\n* @author Rudi Bieller\r\n* @copyright four for business AG <www.4fb.de>\r\n*\r\n* {@internal\r\n* created 2008-04-07\r\n* }}\r\n*/\r\n#cInclude(''frontend'', ''includes/Util/Modules/Contenido_NavMain_Util.class.php'');\r\n\r\n// get start idcat\r\n$iIdcatStart = getEffectiveSetting(''navigation'', ''idcat-meta'', 2);\r\n\r\n//check if there is a template instance\r\nif (!isset($tpl) || !is_object($tpl)) {\r\n    $tpl = new Template();\r\n}\r\n\r\n// reset template object\r\n$tpl->reset();\r\n\r\n// build navigation\r\ntry {\r\n    $oFeNav = new Contenido_FrontendNavigation($db, $cfg, $client, $lang, $cfgClient);\r\n    $oFeNav->setAuth($auth);\r\n    $oContenidoCategories = $oFeNav->getSubCategories($iIdcatStart, true);\r\n    if ($oContenidoCategories->count() > 0) {\r\n        foreach ($oContenidoCategories as $oContenidoCategory) {\r\n            // this is just for sample client - modify to your needs!\r\n            if (($cfg[''url_builder''][''name''] == ''front_content'') || ($cfg[''url_builder''][''name''] == ''MR'')) {\r\n                $aParams = array(''lang'' => $lang, ''idcat'' => $oContenidoCategory->getIdCat());\r\n            } else {\r\n                $aParams = array(''a'' => $oContenidoCategory->getIdCat(), \r\n                                ''idcat'' => $oContenidoCategory->getIdCat(), // needed to build category path\r\n                                ''lang'' => $lang, // needed to build category path\r\n                                ''level'' => 0); // needed to build category path\r\n            }\r\n            try {\r\n                $url = Contenido_Url::getInstance()->build($aParams);\r\n            } catch (InvalidArgumentException $e) {\r\n                $url = ''front_content.php?idcat=''.$oContenidoCategory->getIdCat();\r\n            }\r\n            $sql = ''SELECT al.redirect, al.redirect_url, al.external_redirect\r\n                    FROM '' . $cfg[''tab''][''cat_lang''] . '' AS cl INNER JOIN '' . $cfg[''tab''][''art_lang''] . '' AS al ON cl.startidartlang = al.idartlang AND cl.idlang = al.idlang\r\n                    WHERE ((cl.idcat='' . $oContenidoCategory->getIdCat() . '')\r\n                       AND (cl.idlang='' . $lang . ''))'';\r\n            $db->query($sql);\r\n            if ($db->next_record()) {\r\n                $tpl->set(''d'', ''url'', (($db->f(''external_redirect'')) ? ((substr($db->f(''redirect_url''), 0, 4) == ''http'') ? $db->f(''redirect_url'') : $url) : $url));\r\n                $tpl->set(''d'', ''target'', (($db->f(''external_redirect'')) ? '' target="_blank"'' : ''''));\r\n            } else {\r\n                $tpl->set(''d'', ''url'', $url);\r\n                $tpl->set(''d'', ''target'', '''');\r\n            }\r\n            $tpl->set(''d'', ''title'', $oContenidoCategory->getCategoryLanguage()->getName());\r\n            $tpl->set(''d'', ''label'', $oContenidoCategory->getCategoryLanguage()->getName());\r\n            $tpl->next();\r\n        }\r\n        $sItems = $tpl->generate(''templates/navigation_meta_item.html'', true, false);\r\n        $tpl->reset();\r\n        $tpl->set(''s'', ''items'', $sItems);\r\n        $tpl->generate(''templates/navigation_meta_container.html'');\r\n    }\r\n} catch (Exception $e) {\r\n    echo ''Shit happens: '' . $e->getMessage() . '': '' . $e->getFile() . '' at line ''.$e->getLine() . '' (''.$e->getTraceAsString().'')'';\r\n}\r\n?>', '', 0, NULL, NULL, '48a365b4ce1e322a55ae9017f3daf0c0', '2008-04-14 15:57:53', '2014-02-10 09:52:40');
INSERT INTO `!PREFIX!_mod` VALUES (16, 1, 'Expandable Newslist', 'Content', 'none', 'Newslist with link to show more entries (the set number of entries each time)\r\n\r\nAuthor:   Spider IT Deutschland - Rene Mansveld (www.Spider-IT.de)\r\nVersion:  1.0 (2012-03-13)\r\nBase:     Module "News" by Andreas Lindner (4fb)\r\n\r\nChanges:\r\n2013-10-06 - V.1.2:\r\n - Code optimizations for cleaner and faster code\r\n - Translated all texts to english (with a module translation for german)\r\n\r\n2012-03-13 - V.1.1:\r\n - Added functionality to load additional news entries per ajax\r\n\r\n2005-08-12 - V.1.0\r\n - Initial release by Andreas Lindner (4fb)', NULL, '?><?php\r\n/**\r\n* $RCSfile$\r\n*\r\n* Description: Newslist / ArticleList. Module "Input".\r\n*\r\n* @version 1.0.0\r\n* @author Andreas Lindner\r\n* @copyright four for business AG <www.4fb.de>\r\n*\r\n* {@internal\r\n*   created 2005-08-12\r\n*   modified for drugCMS 2013-10-06: Rene Mansveld - Spider IT Deutschland (www.Spider-IT.de)\r\n* }\r\n*/\r\n\r\n?>\r\n<table>\r\n    <tr>\r\n        <td><?php echo mi18n("Category"); ?></td>\r\n        <td><?php echo buildCategorySelect("CMS_VAR[1]", "CMS_VALUE[1]"); ?>&nbsp;<input type="image" src="images/submit.gif"></td>\r\n    </tr>\r\n    <tr>\r\n        <td><?php echo mi18n("Sort by"); ?></td>\r\n        <td>\r\n            <input type="radio" id="<?php echo "CMS_VAR[3]"; ?>date" name="<?php echo "CMS_VAR[3]"; ?>" value="sortdate"<?php echo (("CMS_VALUE[3]" == ''sortnumber'') ? '''' : '' checked="checked"''); ?>><label for="<?php echo "CMS_VAR[3]"; ?>date"><?php echo mi18n("date"); ?></label>\r\n            <input type="radio" id="<?php echo "CMS_VAR[3]"; ?>number" name="<?php echo "CMS_VAR[3]"; ?>" value="sortnumber"<?php echo (("CMS_VALUE[3]" == ''sortnumber'') ? '' checked="checked"'' : ''''); ?>><label for="<?php echo "CMS_VAR[3]"; ?>number"><?php echo mi18n("number"); ?></label>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td><?php echo mi18n("Sort order"); ?></td>\r\n        <td>\r\n            <input type="radio" id="<?php echo "CMS_VAR[16]"; ?>asc" name="<?php echo "CMS_VAR[16]"; ?>" value="sortasc"<?php echo (("CMS_VALUE[16]" == ''sortasc'') ? '' checked="checked"'' : ''''); ?>><label for="<?php echo "CMS_VAR[16]"; ?>asc"><?php echo mi18n("asc"); ?></label>\r\n            <input type="radio" id="<?php echo "CMS_VAR[16]"; ?>desc" name="<?php echo "CMS_VAR[16]"; ?>" value="sortdesc"<?php echo (("CMS_VALUE[16]" == ''sortasc'') ? '''' : '' checked="checked"''); ?>><label for="<?php echo "CMS_VAR[16]"; ?>desc"><?php echo mi18n("desc"); ?></label>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td><?php echo mi18n("Caption"); ?></td>\r\n        <td><input type="text" name="<?php echo "CMS_VAR[4]"; ?>" value="<?php echo "CMS_VALUE[4]"; ?>" style="width: 400px;"></td>\r\n    </tr>\r\n    <tr>\r\n        <td colspan="2">\r\n            <strong><?php echo mi18n("Teaser image"); ?></strong><br />\r\n            <?php echo mi18n("The first article image will be shown"); ?>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td><?php echo mi18n("Image width"); ?></td>\r\n        <td><input type="text" name="<?php echo "CMS_VAR[14]"; ?>" value="<?php echo intval("CMS_VALUE[14]"); ?>" style="width: 40px;"></td>\r\n    </tr>\r\n    <tr>\r\n        <td><?php echo mi18n("Don''t show images"); ?></td>\r\n        <td><input type="checkbox" name="<?php echo "CMS_VAR[13]"; ?>" value="true"<?php echo (("CMS_VALUE[13]" == "true") ? '' checked="checked"'' : ''''); ?>></td>\r\n    </tr>\r\n    <tr>\r\n        <td><?php echo mi18n("Number of articles"); ?></td>\r\n        <td><input type="text" name="<?php echo "CMS_VAR[15]"; ?>" value="<?php echo intval("CMS_VALUE[15]"); ?>" style="width: 40px;"></td>\r\n    </tr>\r\n    <tr>\r\n        <td><?php echo mi18n("Include start article"); ?></td>\r\n        <td><input type="checkbox" name="<?php echo "CMS_VAR[17]"; ?>" value="yes"<?php echo (("CMS_VALUE[17]" == "yes") ? '' checked="checked"'' : ''''); ?>></td>\r\n    </tr>\r\n</table>\r\n<?php', '<?php\r\n/**\r\n* $RCSfile$\r\n*\r\n* Description: Newslist / ArticleList. Module "Output".\r\n*\r\n* @version 1.0.0\r\n* @author Andreas Lindner\r\n* @copyright four for business AG <www.4fb.de>\r\n*\r\n* {@internal\r\n*   created 2005-08-12\r\n*   modified for drugCMS 2013-10-06: Rene Mansveld - Spider IT Deutschland (www.Spider-IT.de)\r\n* }\r\n*/\r\n\r\n# Includes\r\ncInclude(''includes'', ''functions.api.string.php'');\r\ncInclude(''includes'', ''functions.api.images.php'');\r\ncInclude(''frontend'', ''includes/spider-it.functions.inc.php'');\r\n$debug = 1;\r\n\r\n# Settings\r\n$mxtext             = 250;\r\n$selcat             = intval("CMS_VALUE[1]");\r\n$order_by           = (("CMS_VALUE[3]" == "sortdate") ? ''lastmodified'' : ''artsort'');\r\n$cms_sort_direction = ((strlen("CMS_VALUE[16]")) ? substr("CMS_VALUE[16]", 4) : ''desc'');\r\n$newsheadline       = "CMS_VALUE[4]";\r\n$img_size           = "CMS_VALUE[14]";\r\n$noimg              = (("CMS_VALUE[13]" == ''true'') ? true : false);\r\n$limit              = intval("CMS_VALUE[15]");\r\n$with_start         = ((strlen("CMS_VALUE[17]")) ? true : false);\r\n\r\n# Execution\r\n$page = ((isset($_REQUEST[''p''])) ? intval($_REQUEST[''p'']) : 1);\r\nif ((strlen($selcat)) && ($selcat != ''0'')) {\r\n    \r\n    # Get the date format from the language settings\r\n    $oLang = new Language;\r\n    $oLang->loadByPrimaryKey($lang);\r\n    $dateFormat = $oLang->getProperty(''dateformat'', ''full'');\r\n    if (!strlen($dateFormat)) {\r\n        $dateFormat = ''Y-m-d H:i:s'';\r\n    }\r\n    \r\n    # Load the articles to show\r\n    $oAC = new ArticleCollection(array(''idcat'' => $selcat, ''start'' => $with_start, ''order'' => $order_by, ''direction'' => $cms_sort_direction));\r\n    \r\n    $count = $oAC->count;\r\n    if ($count > 0) {\r\n        if ($limit) {\r\n            if (($page * $limit) < $count) {\r\n                $limit_min = (($page * $limit) - $limit);\r\n                $limit_max = ($page * $limit);\r\n            } else {\r\n                $limit_min = (($page * $limit) - $limit);\r\n                $limit_max = $count;\r\n            }\r\n        } else {\r\n            $limit_min = 0;\r\n            $limit_max = $count;\r\n        }\r\n        if ($limit_min > 0) {\r\n            \r\n            # Drop the previously built page content\r\n            ob_end_clean();\r\n            # If $limit_min isn''t 0, the first $limit_min articles must be ignored\r\n            for ($i = 0; $i < $limit_min; $i ++) {\r\n                $oArt = $oAC->nextArticle();\r\n            }\r\n        }\r\n        \r\n        $oTpl = new Template();\r\n        $oTplContent = new Template();\r\n        \r\n        $oTpl->set(''s'', ''TITLE'', $newsheadline);\r\n        \r\n        for ($i = $limit_min; $i < $limit_max; $i ++) {\r\n            $oArt = $oAC->nextArticle();\r\n            $artid = $oArt->getField(''idart'');\r\n            \r\n            $text_html = '''';\r\n            for ($n = 0; $n < 10; $n ++) {\r\n                $text_html .= $oArt->getContent(''CMS_HTML'', $n);\r\n            }\r\n            \r\n            $teaser_img = '''';\r\n            if (!$noimg) {\r\n                $regEx = "/<img[^>]*?>.*?/i";\r\n                $match = array();\r\n                preg_match($regEx, $text_html, $match);\r\n                \r\n                $regEx = "/(src)(=)([''\\"]?)([^\\"'']*)([''\\"]?)/i";\r\n                $img = array();\r\n                preg_match($regEx, $match[0], $img);\r\n                $img_src = preg_split("/\\//", $img[0]);\r\n                \r\n                $img_name = $img_src[count($img_src) - 1];\r\n                $img_name = preg_replace("/\\"/", "", $img_name);\r\n                $img_split = preg_split("/\\./", $img_name);\r\n                $img_type = $img_split[count($img_split) - 1];\r\n                \r\n                $img_split2 = preg_split("/_/", $img_split[0]);\r\n                \r\n                $name = $img_name;\r\n                \r\n                if (count($img_split2) > 1) {\r\n                    $img_x = $img_split2[count($img_split2) - 1];\r\n                    $img_y = $img_split2[count($img_split2) - 2];\r\n                    \r\n                    if (is_numeric($img_x) && is_numeric($img_y)) {\r\n                        $suffix = "_".$img_x."_".$img_y.".".$img_type;\r\n                        $name = preg_replace("/$suffix/", "", $img_name);\r\n                        $name = $name.".[a-zA-Z]{3}";\r\n                    }\r\n                }\r\n                \r\n                $img_teaser = '''';\r\n                \r\n                if (strlen($name) > 0) {\r\n                    $sql = ''SELECT *\r\n                            FROM '' . $cfg["tab"]["upl"] . ''\r\n                            WHERE (filename REGEXP "'' . $name . ''")'';\r\n                    $db->query($sql);\r\n                    if ($db->next_record()) {\r\n                        $filename = $db->f(''filename'');\r\n                        $dirname = $db->f(''dirname'');\r\n                    }\r\n                    \r\n                    $img_path = $cfgClient[$client]["upl"]["path"].$dirname.$filename;\r\n                    \r\n                    \r\n                    $img_teaser = capiImgScale($img_path, $img_size, $img_size, $crop = false, $expand = false, $cacheTime = 1000, $wantHQ = false);\r\n                } // end if strlen\r\n                \r\n                if (strlen($img_teaser) > 0) {\r\n                    $teaser_img = ''<img src="''.$img_teaser.''" class="teaser_img">'';\r\n                } else {\r\n                    $teaser_img = '''';\r\n                }\r\n                \r\n            } // end if noimg       \r\n            \r\n            $headline = strip_tags(str_replace(array(''</p>'', ''<br''), array(''</p> '', '' <br''), $oArt->getContent(''CMS_HTMLHEAD'', 1)));\r\n            \r\n            $subheadline = strip_tags(str_replace(array(''</p>'', ''<br''), array(''</p> '', '' <br''), $oArt->getContent(''CMS_HTMLHEAD'', 2)));\r\n            \r\n            $teaserheadline = $headline . ((strlen($subheadline)) ? '' - '' . $subheadline : '''');\r\n            $href = $sess->url("front_content.php?idcat=$selcat&amp;idart=$artid");\r\n            # Use the article summary text as teaser text\r\n            $teasertext = $oArt->getField(''summary'');\r\n            # If no article summary text was there, use the article content as teaser text\r\n            if (strlen(trim($teasertext)) == 0) {\r\n                # Strip the tags from the article content while inserting a space on line breaks\r\n                $teasertext = strip_tags(str_replace(array(''</p>'', ''<br''), array(''</p> '', '' <br''), $text_html));\r\n                # Shorten the text if nessecary\r\n                $teasertext2 = $teasertext;\r\n                $teasertext = capiStrTrimAfterWord($teasertext, $mxtext);\r\n                if (strlen($teasertext) < strlen($teasertext2)) {\r\n                    $teasertext .= ''&hellip;'';\r\n                }\r\n                \r\n            } // end if             \r\n            \r\n            $teasertext .= ''&nbsp;'';\r\n            \r\n            $oTplContent->set(''d'', ''HEADLINE'', $teaserheadline);\r\n            $oTplContent->set(''d'', ''DATE'', date($dateFormat, strtotime($oArt->getField(''lastmodified''))));\r\n            $oTplContent->set(''d'', ''TEXT'', $teasertext);\r\n            $oTplContent->set(''d'', ''HREF'', $href);\r\n            $oTplContent->set(''d'', ''IMG'', $teaser_img);\r\n            $oTplContent->set(''d'', ''MORE'', mi18n("more"));\r\n            \r\n            $oTplContent->next();\r\n            \r\n        } // end for\r\n        $oTplContent->set(''s'', ''WEITER_ID'', ''Weitere'' . $page);\r\n        $oTplContent->set(''s'', ''WEITER_LINK'', (($limit_max < $count) ? ''<a href="javascript:newNewsContent(\\''Weitere'' . $page . ''\\'', \\'''' . $sess->url(''front_content.php?idart='' . $idart . ''&amp;p='' . ($page + 1)) . ''\\'')">'' . mi18n("More news messages") . ''</a>'' : ''''));\r\n        \r\n        if ($limit_min > 0) {\r\n            $oTplContent->generate(''templates/expandable-newslist_content.html'', false, false);\r\n            die();\r\n        } else {\r\n            $oTpl->set(''s'', ''LISTE'', $oTplContent->generate(''templates/expandable-newslist_content.html'', true, false));\r\n            $oTpl->generate(''templates/expandable-newslist.html'', false, false);\r\n        }\r\n    }\r\n}\r\n?>', '', 0, NULL, NULL, '48a365b4ce1e322a55ae9017f3daf0c0', '2008-04-14 15:58:05', '2013-10-08 14:57:19');
INSERT INTO `!PREFIX!_mod` VALUES (17, 1, 'Newsletter_Form', 'Content', 'none', 'Newsletter Subscription Module V4.0.0 (for text and HTML newsletters)\r\n\r\nProvides multilanguage form for newsletter subscribing and cancellation.\r\n\r\nBased on the work of 4fb, www.x28.de, HerrB, 01.06.2007\r\n\r\nNotes:\r\n- The default language is english. Use the translation functionality to translate the module in other languages\r\n- Create a template which includes this module and create an article using that template.\r\n- Configure category/arcticle specifying handler article id', NULL, '   // Includes\r\n   cInclude(''frontend'', ''includes/class.input.helper.php''); # Note, this file is located in <client-path>/includes!\r\n\r\n   // Initialisation\r\n   $oClientLang = new cApiClientLanguage(false, $client, $lang);\r\n\r\n   /*\r\n   *  Used variables:\r\n   *  JoinSel:         Selection, which group will be joined (Default, Selected, UserSelected)\r\n   *  JoinMultiple:    If JoinSel = UserSelected then: If more than one group has been specified, select more than one\r\n   *  JoinGroups:      Selected group(s)\r\n   *  JoinMessageType: Message type for new recipients: User select (user), text or html\r\n   *  OptNewWindow:    Open handler window in new browser window?\r\n   */\r\n   $aSettings   = array();\r\n   $aSettings[''JoinSel'']         = $oClientLang->getProperty(''newsletter'', ''joinsel'');\r\n   $aSettings[''JoinMultiple'']    = $oClientLang->getProperty(''newsletter'', ''joinmultiple'');\r\n   $aSettings[''JoinGroups'']      = $oClientLang->getProperty(''newsletter'', ''joingroups'');\r\n   $aSettings[''JoinMessageType''] = $oClientLang->getProperty(''newsletter'', ''joinmessagetype'');\r\n   $aSettings[''OptNewWindow'']    = "CMS_VALUE[4]";\r\n   \r\n   // Setting default values\r\n   /*\r\n   *  If nothing is set or if the option "UserSelected" has been activated, but no groups\r\n   *  have been selected, set option "Default". Note, that requiring to select groups when option\r\n   *  "Selected" has been activated doesn''t make so much sense here (even, as it is possible to do).\r\n   *  Why? Because the groups to be joined have to be specified on the handler page, not here...\r\n   *  To prevent users to select a group (or not to save the selection) when the option "Selected" is\r\n   *  active should make more problems than just to ignore the selection in the Output area\r\n   */\r\n   \r\n   if ($aSettings[''JoinSel''] == '''' || ($aSettings[''JoinSel''] == ''UserSelected'' && $aSettings[''JoinGroups''] == '''')) {\r\n      $aSettings[''JoinSel''] = ''Default'';\r\n   }\r\n   if (!is_numeric($_REQUEST[''selHandlerCatArt''.$cnumber]) || $_REQUEST[''selHandlerCatArt''.$cnumber] < 0) {\r\n      $_REQUEST[''selHandlerCatArt''.$cnumber] = 0;\r\n   }\r\n   \r\n   // Saving changes, if any\r\n   if ($_REQUEST[''hidAction''.$cnumber] == ''save'')\r\n   {\r\n      if ($_REQUEST[''radJoin''.$cnumber] != '''' && $_REQUEST[''radJoin''.$cnumber] != $aSettings[''JoinSel''])\r\n      {\r\n         $aSettings[''JoinSel''] = $_REQUEST[''radJoin''.$cnumber];\r\n         $oClientLang->setProperty(''newsletter'', ''joinsel'', $aSettings[''JoinSel'']);\r\n      }\r\n      if ($_REQUEST[''ckbJoinMultiple''.$cnumber] != $aSettings[''JoinMultiple''])\r\n      {\r\n         $aSettings[''JoinMultiple''] = $_REQUEST[''ckbJoinMultiple''.$cnumber];\r\n         $oClientLang->setProperty(''newsletter'', ''joinmultiple'', $aSettings[''JoinMultiple'']);\r\n      }\r\n      if ($_REQUEST[''hidJoinGroups''.$cnumber] != '''' && $_REQUEST[''hidJoinGroups''.$cnumber] != $aSettings[''JoinGroups''])\r\n      {\r\n         $aSettings[''JoinGroups''] = $_REQUEST[''hidJoinGroups''.$cnumber];\r\n         $oClientLang->setProperty(''newsletter'', ''joingroups'', $aSettings[''JoinGroups'']);\r\n      }\r\n      if ($_REQUEST[''selMessageType''.$cnumber] != $aSettings[''JoinMessageType''])\r\n      {\r\n         $aSettings[''JoinMessageType''] = $_REQUEST[''selMessageType''.$cnumber];\r\n         $oClientLang->setProperty(''newsletter'', ''joinmessagetype'', $aSettings[''JoinMessageType'']);\r\n      }\r\n   \r\n      if ($_REQUEST[''ckbUpdateHandlerID''.$cnumber] == ''enabled'')\r\n      {\r\n         // Trick: If UpdateHandlerID is enabled, save id as client setting\r\n         $iHandlerCatArt = $_REQUEST[''selHandlerCatArt''.$cnumber];\r\n         $oClientLang->setProperty(''newsletter'', ''idcatart'', $iHandlerCatArt);\r\n      }\r\n   }\r\n   // Getting current handler article id\r\n   $iHandlerCatArt = $oClientLang->getProperty(''newsletter'', ''idcatart'');\r\n   unset ($oClientLang);\r\n   \r\n   // Showing options\r\n   $oCfgTable = new UI_Config_Table;\r\n   \r\n   $oHidAction        = new cHTMLHiddenField(''hidAction''.$cnumber, ''save'');\r\n   \r\n   $oSelHandlerCatArt = new cHTMLInputSelectElement(''selHandlerCatArt''.$cnumber, 1, '''', true);\r\n   $oOption           = new cHTMLOptionElement(mi18n("- Please select -"), '''');\r\n   $oSelHandlerCatArt->addOptionElement(0, $oOption);\r\n   $oSelHandlerCatArt->addCategories(0, true, false, false, true, true);\r\n   $oSelHandlerCatArt->setDefault($iHandlerCatArt);\r\n   \r\n   $oCkbUpdate        = new cHTMLCheckbox(''ckbUpdateHandlerID''.$cnumber, ''enabled'');\r\n   $oCkbUpdate->setEvent(''click'', ''if (this.checked) {document.forms[0].selHandlerCatArt''.$cnumber.''.disabled = false;} else {document.forms[0].selHandlerCatArt''.$cnumber.''.disabled = true;}'');\r\n   \r\n   $oCfgTable->setCell(''handler'', 0, mi18n("Handler Article:"));\r\n   $oCfgTable->setCell(''handler'', 1, $oHidAction->render().$oSelHandlerCatArt->render()."\\n&nbsp;".$oCkbUpdate->toHTML(false).mi18n("Update"));\r\n   \r\n   // Getting newsletter groups (if any)\r\n   $oRcpGroups = new RecipientGroupCollection;\r\n   $oRcpGroups->setWhere(''idclient'', $client);\r\n   $oRcpGroups->setWhere(''idlang'',   $lang);\r\n   $oRcpGroups->setWhere(''defaultgroup'', ''0'');\r\n   $oRcpGroups->setOrder(''defaultgroup DESC, groupname ASC'');\r\n   $oRcpGroups->query();\r\n   \r\n   // Join options\r\n   // If newsletter groups are available, provide group options, otherwise show only\r\n   // ''Default'' option. This is necessary, as there may have been groups specified (and used)\r\n   // but they have been deleted, later on.\r\n   \r\n   $oCfgTable->setCell(''join_01'', 0, mi18n("Join:"));\r\n   \r\n   if ($oRcpGroups->Count() == 0) {\r\n      // No groups available, only default group possible\r\n   \r\n      $oRadJoinDefault = new cHTMLRadioButton (''radJoin''.$cnumber, ''Default'', '''', true);\r\n      $oCfgTable->setCell(''join_01'', 1, $oRadJoinDefault->toHTML(false).mi18n("default group"));\r\n   } else {\r\n      // Groups available, show different group join options\r\n   \r\n      // Join default group only\r\n      if ($aSettings[''JoinSel''] == ''Default'') {\r\n         $oRadJoinDefault = new cHTMLRadioButton (''radJoin''.$cnumber, ''Default'', '''', true);\r\n      } else {\r\n         $oRadJoinDefault = new cHTMLRadioButton (''radJoin''.$cnumber, ''Default'');\r\n      }\r\n      $oRadJoinDefault->setEvent(''click'', "document.forms[0].elements[''ckbJoinMultiple".$cnumber."''].disabled = true; document.forms[0].selGroup".$cnumber.".disabled = true;");\r\n      $oCfgTable->setCell(''join_01'', 1, $oRadJoinDefault->toHTML(false).mi18n("default group"));\r\n      $oCfgTable->setRowBgColor(''join_01'', $cfg["color"]["table_light"]);\r\n   \r\n      // Join admin selected groups automatically\r\n      if ($aSettings[''JoinSel''] == ''Selected'') {\r\n         $oRadJoinSelected = new cHTMLRadioButton (''radJoin''.$cnumber, ''Selected'', '''', true);\r\n      } else {\r\n         $oRadJoinSelected = new cHTMLRadioButton (''radJoin''.$cnumber, ''Selected'');\r\n      }\r\n      $oRadJoinSelected->setEvent(''click'', "document.forms[0].elements[''ckbJoinMultiple".$cnumber."''].disabled = false; document.forms[0].selGroup".$cnumber.".disabled = false;");\r\n      $oCfgTable->setCell(''join_02'', 0, '''');\r\n      $oCfgTable->setCell(''join_02'', 1, $oRadJoinSelected->toHTML(false).mi18n("selected group(s)"));\r\n      $oCfgTable->setRowBgColor(''join_02'', $cfg["color"]["table_light"]);\r\n   \r\n      // Join the groups the user has selected (-> provide a list for the user), optionally, the user may select more than one group\r\n      if ($aSettings[''JoinSel''] == ''UserSelected'')\r\n      {\r\n         $oRadJoinUserSel  = new cHTMLRadioButton (''radJoin''.$cnumber, ''UserSelected'', '''', true);\r\n         $oCkbJoinMultiple = new cHTMLCheckbox (''ckbJoinMultiple''.$cnumber, ''enabled'', '''', $aSettings[''JoinMultiple'']);\r\n      } else {\r\n         $oRadJoinUserSel  = new cHTMLRadioButton (''radJoin''.$cnumber, ''UserSelected'');\r\n         $oCkbJoinMultiple = new cHTMLCheckbox (''ckbJoinMultiple''.$cnumber, ''enabled'', '''', false, true);\r\n      }\r\n      $oRadJoinUserSel->setEvent(''click'', "document.forms[0].elements[''ckbJoinMultiple".$cnumber."''].disabled = false; document.forms[0].selGroup".$cnumber.".disabled = false;");\r\n      $oCfgTable->setCell(''join_03'', 0, '''');\r\n      $oCfgTable->setCell(''join_03'', 1, $oRadJoinUserSel->toHTML(false).mi18n("group(s) as selected by user").''<br />''."\\n".$oCkbJoinMultiple->toHTML(false).mi18n("Multiple group selection allowed"));\r\n      $oCfgTable->setRowBgColor(''join_03'', $cfg["color"]["table_light"]);\r\n   \r\n      $oCfgTable->setCell(''groups'', 0, mi18n("Select group(s):"));\r\n   \r\n      // Show groups\r\n      // Trick: To save multiple selections in <select>-Element, add some JS which saves the\r\n      // selection, comma separated in a hidden input field on change.\r\n      $sSkript = ''              <script type="text/javascript"><!--''."\\n".\r\n                 ''                  function fncUpdateSel() {''."\\n".\r\n                 ''                     var strSel = "";''."\\n".\r\n                 ''                     for(i = 0; i < document.forms[0].selGroup''.$cnumber.''.length; i++) {''."\\n".\r\n                 ''                        if(document.forms[0].selGroup''.$cnumber.''.options[i].selected == true) {''."\\n".\r\n                 ''                           if (strSel != "")''."\\n".\r\n                 ''                              strSel = strSel + ",";''."\\n".\r\n                 ''                           strSel = strSel + document.forms[0].selGroup''.$cnumber.''.options[i].value;''."\\n".\r\n                 ''                        }''."\\n".\r\n                 ''                     }''."\\n".\r\n                 ''                     document.forms[0].elements["hidJoinGroups''.$cnumber.''"].value = strSel;''."\\n".\r\n                 ''                  }''."\\n".\r\n                 ''                  //--></script>''."\\n";\r\n\r\n      if ($aSettings[''JoinSel''] == ''Default'') {\r\n         $oSelGroup = new cHTMLSelectElement (''selGroup''.$cnumber, '''', '''', true);\r\n      } else {\r\n         $oSelGroup = new cHTMLSelectElement (''selGroup''.$cnumber, '''');\r\n      }\r\n      $oSelGroup->setSize(5);\r\n      $oSelGroup->setMultiselect();\r\n      $oSelGroup->setEvent(''change'', "fncUpdateSel()");\r\n\r\n      $aGroups = explode('','', $aSettings[''JoinGroups'']);\r\n      while ($oRcpGroup = $oRcpGroups->next()) {\r\n         $iID = $oRcpGroup->get(''idnewsgroup'');\r\n         if (in_array ($iID, $aGroups)) {\r\n            $oOption = new cHTMLOptionElement($oRcpGroup->get(''groupname''), $iID, true);\r\n         } else {\r\n            $oOption = new cHTMLOptionElement($oRcpGroup->get(''groupname''), $iID, false);\r\n         }\r\n         $oSelGroup->addOptionElement($iID, $oOption);\r\n      }\r\n   \r\n      $oHidGroups = new cHTMLHiddenField (''hidJoinGroups''.$cnumber, $aSettings[''JoinGroups'']);\r\n      $oCfgTable->setCell(''groups'', 1, $sSkript.$oSelGroup->render().$oHidGroups->render());\r\n   }\r\n   \r\n   // Options: Message type (user [->selectbox], text or html)\r\n   $oCfgTable->setCell(''options_01'', 0, mi18n("Options:"));\r\n\r\n   $oSelMsgType = new cHTMLSelectElement (''selMessageType''.$cnumber);\r\n   $oOption = new cHTMLOptionElement(mi18n("User selected"), "user");\r\n   $oSelMsgType->addOptionElement(0, $oOption);\r\n   $oOption = new cHTMLOptionElement(mi18n("Text only"), "text");\r\n   $oSelMsgType->addOptionElement(1, $oOption);\r\n   $oOption = new cHTMLOptionElement(mi18n("HTML and text"), "html");\r\n   $oSelMsgType->addOptionElement(2, $oOption);\r\n   $oSelMsgType->setDefault($aSettings[''JoinMessageType'']);\r\n\r\n   $oCfgTable->setCell(''options_01'', 1, mi18n("Default message type:").''&nbsp;''.$oSelMsgType->render());\r\n   \r\n   // Options: Open handler article in new window?\r\n   $oCfgTable->setCell(''options_02'', 0, '''');\r\n   $oCkbNewWindow = new cHTMLCheckbox("CMS_VAR[4]", ''enabled'', '''', "CMS_VALUE[4]");\r\n   $oCfgTable->setCell(''options_02'', 1, $oCkbNewWindow->toHTML(false).mi18n("Open handler article in new window"));\r\n   $oCfgTable->setRowBgColor(''options_02'', $cfg["color"]["table_light"]);\r\n   \r\n   $oCfgTable->render(true);', '<?php\r\n   // Initialisation\r\n   $oClientLang = new cApiClientLanguage(false, $client, $lang);\r\n\r\n   /*\r\n   *  Used variables:\r\n   *  JoinSel:         Selection, which group will be joined (Default, Selected, UserSelected)\r\n   *  JoinMultiple:    If JoinSel = UserSelected then: If more than one group has been specified, select more than one\r\n   *  JoinGroups:      Selected group(s)\r\n   *  JoinMessageType: Message type for new recipients: User select (user), text or html\r\n   *  OptNewWindow:    Open handler window in new browser window?\r\n   */\r\n   $aSettings   = array();\r\n   $aSettings[''JoinSel'']         = $oClientLang->getProperty(''newsletter'', ''joinsel'');\r\n   $aSettings[''JoinMultiple'']    = $oClientLang->getProperty(''newsletter'', ''joinmultiple'');\r\n   $aSettings[''JoinGroups'']      = $oClientLang->getProperty(''newsletter'', ''joingroups'');\r\n   $aSettings[''JoinMessageType''] = $oClientLang->getProperty(''newsletter'', ''joinmessagetype'');\r\n   $aSettings[''OptNewWindow'']    = "CMS_VALUE[4]";\r\n\r\n   $sTemplate = ''newsletter_form.html'';\r\n\r\n   if ($aSettings["JoinSel"] == "" || ($aSettings["JoinSel"] == "UserSelected" && $aSettings["JoinGroups"] == "")) {\r\n      $aSettings["JoinSel"]= "Default";\r\n   }\r\n\r\n   if (!isset($oPage) || !is_object($oPage)) {\r\n      $oPage = new Template;\r\n   }\r\n   $oPage->reset();\r\n\r\n   $oPage->set(''s'', ''FORM_ACTION'', ''front_content.php?changelang=''.$lang.''&amp;idcatart=''.\r\n                                   $oClientLang->getProperty(''newsletter'', ''idcatart''));\r\n   unset ($oClientLang);\r\n\r\n   if ($aSettings["OptNewWindow"]) {\r\n      $oPage->set(''s'', ''FORM_TARGET'', '' target="_blank"'');\r\n   } else {\r\n      $oPage->set(''s'', ''FORM_TARGET'', '''');\r\n   }\r\n   $oPage->set(''s'', ''EMAILNAME'', mi18n("Name"));\r\n   $oPage->set(''s'', ''EMAIL'',     mi18n("E-Mail"));\r\n\r\n   $sTmpHTML = "";\r\n   if ($aSettings["JoinSel"] == "UserSelected") {\r\n      // Late include to increase performance\r\n\r\n      $oRcpGroups = new RecipientGroupCollection;\r\n      $oRcpGroups->setWhere(''idclient'', $client);\r\n      $oRcpGroups->setWhere(''idlang'',   $lang);\r\n      $oRcpGroups->setWhere(''defaultgroup'', ''0'');\r\n      $oRcpGroups->setWhere(''idnewsgroup'', explode('','', $aSettings["JoinGroups"]), ''IN'');\r\n      $oRcpGroups->setOrder(''groupname ASC'');\r\n      $oRcpGroups->query();\r\n\r\n      #$oRcpGroups->select("idclient = ''$client'' AND idlang = ''$lang'' AND defaultgroup = ''0'' AND idnewsgroup IN (".$aSettings["JoinGroups"].")","", "groupname ASC");\r\n\r\n      if ($oRcpGroups->Count() > 0) {\r\n         $oLblGroupSel = new cHTMLLabel(mi18n("Select"), "selNewsletterGroup");\r\n\r\n         $oSelGroup = new cHTMLSelectElement("selNewsletterGroup[]", "", "selNewsletterGroup");\r\n         $oSelGroup->setSize(2);\r\n         $oSelGroup->setClass("");\r\n\r\n         if ($aSettings["JoinMultiple"] == "enabled") {\r\n            $oSelGroup->setMultiselect();\r\n         }\r\n         \r\n         while ($oRcpGroup = $oRcpGroups->next())\r\n         {\r\n            $iID = $oRcpGroup->get("idnewsgroup");\r\n            $oOption = new cHTMLOptionElement ($oRcpGroup->get("groupname"), $iID);\r\n            $oSelGroup->addOptionElement($iID, $oOption);\r\n         }\r\n\r\n         $sTmpHTML .= ''         ''.$oLblGroupSel->toHTML()."\\n";\r\n         $sTmpHTML .= ''         ''.$oSelGroup->render()."\\n";\r\n         $sTmpHTML .= ''         <br class="y"/>'';\r\n      }\r\n   }\r\n   // You may like to add here additional rows for fields used in recipient- or frontenduser-plugins\r\n   // $sTmpHTML .= ''...'';\r\n\r\n   if ($aSettings[''JoinMessageType''] == ''user'')\r\n   {\r\n         $oLblType = new cHTMLLabel(mi18n("Type"), "selNewsletterType");\r\n\r\n         $oSelType = new cHTMLSelectElement("selNewsletterType", "", "selNewsletterType");\r\n         $oSelType->setSize(1);\r\n         $oSelType->setClass("");\r\n         \r\n         $oOption = new cHTMLOptionElement (mi18n("Text only"), 0);\r\n         $oSelType->addOptionElement(0, $oOption);\r\n         $oOption = new cHTMLOptionElement (mi18n("HTML"), 1);\r\n         $oSelType->addOptionElement(1, $oOption);\r\n\r\n         //$sTmpHTML .= ''         ''.$oLblType->toHTML()."\\n";\r\n         $sTmpHTML .= ''         ''.$oSelType->render()."\\n";\r\n         $sTmpHTML .= ''         <br class="y"/>'';\r\n   }\r\n   $oPage->set(''s'', ''EXTRAHTML'', $sTmpHTML);\r\n\r\n   $oPage->set(''s'', ''NEWSLETTER'', mi18n("Newsletter"));\r\n   $oPage->set(''s'', ''SUBSCRIBE'',  mi18n("Subscribe"));\r\n   $oPage->set(''s'', ''DELETE'',     mi18n("Unsubscribe"));\r\n\r\n   $oPage->set("s", "ABSCHICKEN", mi18n("submit"));\r\n   $oPage->set("s", "LOESCHEN", mi18n("delete"));\r\n   $oPage->set(''s'', ''JOIN'', mi18n("Join"));\r\n\r\n   $oPage->generate(''templates/''.$sTemplate);\r\n?>', '', 0, NULL, NULL, '48a365b4ce1e322a55ae9017f3daf0c0', '2008-04-14 15:58:33', '0000-00-00 00:00:00');
INSERT INTO `!PREFIX!_mod` VALUES (18, 1, 'Newsletter_Handler', 'Content', 'none', 'Newsletter Handler Module V4.0.1 (for text and HTML newsletters)\r\n\r\nProvides multilanguage handling for newsletter subscribing, cancellation and other features.\r\n\r\nBased on the work of 4fb, www.x28.de, HerrB, 01.05.2007\r\n\r\nNotes:\r\n- The default language is english. Use the translation functionality to translate the module in other languages\r\n- Create a template which includes this module and create an article using that template.\r\n- Configure category/arcticle specifying handler article id', NULL, '   cInclude(''frontend'', ''includes/class.input.helper.php''); # Note, this file is located in <client-path>/includes!\r\n\r\n   // Initialisation\r\n   $oClientLang = new cApiClientLanguage(false, $client, $lang);\r\n   $oClient     = new cApiClient($client);\r\n\r\n   /*\r\n   *  Used variables:\r\n   *  JoinSel:         Selection, which group will be joined (Default, Selected, User specified)\r\n   *  JoinMultiple:    If JoinSel = UserSelected then: More than one group may be selected\r\n   *  JoinGroups:      Selected group(s)\r\n   *  JoinMessageType: Message type for new recipients: User select (user), text or html\r\n   *  FrontendLink:    Link to Frontend Users enabled?\r\n   *  FrontendConfirm: Confirmation of newsletter subscription means: Activate frontend account, nothing\r\n   *  FrontendDel:     Cancellation of newsletter subscription means: Delete frontend account, Deactivate account, nothing\r\n   *  SenderEMail:     Sender e-mail address\r\n   *  HandlerID:       ID of handler article\r\n   *  ChangeEMailID:   ID of change e-mail handler article\r\n   */\r\n   $aSettings   = array();\r\n   $aSettings[''JoinSel'']         = $oClientLang->getProperty(''newsletter'', ''joinsel'');\r\n   $aSettings[''JoinMultiple'']    = $oClientLang->getProperty(''newsletter'', ''joinmultiple'');\r\n   $aSettings[''JoinGroups'']      = $oClientLang->getProperty(''newsletter'', ''joingroups'');\r\n   $aSettings[''JoinMessageType''] = $oClientLang->getProperty(''newsletter'', ''joinmessagetype'');\r\n   $aSettings[''FrontendLink'']    = $oClient->getProperty(''newsletter'', ''frontendlink''); # Note: Stored for client, as frontendusers are language independent\r\n   $aSettings[''FrontendConfirm''] = "CMS_VALUE[5]";\r\n   $aSettings[''FrontendDel'']     = "CMS_VALUE[6]";\r\n   $aSettings[''SenderEMail'']     = $oClient->getProperty(''global'', ''sender-email''); # This one could be recycled by other modules...\r\n\r\n   // Setting default values\r\n   // If there is no selection option set or if no groups has been selected, activate option Default\r\n   if ($aSettings[''JoinSel''] == '''' || $aSettings[''JoinGroups''] == '''') {\r\n      $aSettings[''JoinSel''] = "Default";\r\n   }\r\n   if ($aSettings[''FrontendConfirm''] == '''') {\r\n      $aSettings[''FrontendConfirm''] = "ActivateUser";\r\n   }\r\n   if ($aSettings[''FrontendDel''] == '''') {\r\n      $aSettings[''FrontendDel''] = "DeleteUser";\r\n   }\r\n   if (!is_numeric($_REQUEST[''selHandlerCatArt''.$cnumber]) || $_REQUEST[''selHandlerCatArt''.$cnumber] < 0) {\r\n      $_REQUEST[''selHandlerCatArt''.$cnumber] = 0;\r\n   }\r\n\r\n   // Saving changes, if any\r\n   if ($_REQUEST[''hidAction''.$cnumber] == ''save'')\r\n   {\r\n      if ($_REQUEST[''radJoin''.$cnumber] != '''' && $_REQUEST[''radJoin''.$cnumber] != $aSettings[''JoinSel''])\r\n      {\r\n         $aSettings[''JoinSel''] = $_REQUEST[''radJoin''.$cnumber];\r\n         $oClientLang->setProperty(''newsletter'', ''joinsel'', $aSettings[''JoinSel'']);\r\n      }\r\n      if ($_REQUEST[''ckbJoinMultiple''.$cnumber] != $aSettings[''JoinMultiple''])\r\n      {\r\n         $aSettings[''JoinMultiple''] = $_REQUEST[''ckbJoinMultiple''.$cnumber];\r\n         $oClientLang->setProperty(''newsletter'', ''joinmultiple'', $aSettings[''JoinMultiple'']);\r\n      }\r\n      if ($_REQUEST[''hidJoinGroups''.$cnumber] != '''' && $_REQUEST[''hidJoinGroups''.$cnumber] != $aSettings[''JoinGroups''])\r\n      {\r\n         $aSettings[''JoinGroups''] = $_REQUEST[''hidJoinGroups''.$cnumber];\r\n         $oClientLang->setProperty(''newsletter'', ''joingroups'', $aSettings[''JoinGroups'']);\r\n      }\r\n      if ($_REQUEST[''selMessageType''.$cnumber] != $aSettings[''JoinMessageType''])\r\n      {\r\n         $aSettings[''JoinMessageType''] = $_REQUEST[''selMessageType''.$cnumber];\r\n         $oClientLang->setProperty(''newsletter'', ''joinmessagetype'', $aSettings[''JoinMessageType'']);\r\n      }\r\n      if ($_REQUEST[''ckbFrontendLink''.$cnumber] != $aSettings[''FrontendLink''])\r\n      {\r\n         $aSettings[''FrontendLink''] = $_REQUEST[''ckbFrontendLink''.$cnumber];\r\n         $oClient->setProperty(''newsletter'', ''frontendlink'', $aSettings[''FrontendLink'']);\r\n      }\r\n\r\n      if ($_REQUEST[''ckbUpdateHandlerID''.$cnumber] == ''enabled'')\r\n      {\r\n         // Trick: If UpdateHandlerID is enabled, save id as client setting\r\n         $iHandlerCatArt = $_REQUEST[''selHandlerCatArt''.$cnumber];\r\n         $oClientLang->setProperty(''newsletter'', ''idcatart'', $iHandlerCatArt);\r\n      }\r\n      \r\n      if (isValidMail($_REQUEST[''txtSender''.$cnumber]) && $_REQUEST[''txtSender''.$cnumber] != $aSettings[''SenderEMail''])\r\n      {\r\n         $aSettings[''SenderEMail''] = $_REQUEST[''txtSender''.$cnumber];\r\n         $oClient->setProperty(''global'', ''sender-email'', $aSettings[''SenderEMail'']);\r\n      }\r\n   }\r\n\r\n   // Getting current handler article id\r\n   $iHandlerCatArt = $oClientLang->getProperty(''newsletter'', ''idcatart'');\r\n   unset ($oClientLang);\r\n   unset ($oClient);\r\n\r\n   // Show options\r\n   $oCfgTable = new UI_Config_Table;\r\n\r\n   $oHidAction        = new cHTMLHiddenField(''hidAction''.$cnumber, ''save'');\r\n   \r\n   $oTxtSender = new cHTMLTextbox("txtSender".$cnumber, $aSettings[''SenderEMail''], 30);\r\n\r\n   $oCfgTable->setCell(''sender'', 0, mi18n("Sender e-mail:"));\r\n   $oCfgTable->setCell(''sender'', 1, $oHidAction->render().$oTxtSender->render());\r\n\r\n   $oSelHandlerCatArt = new cHTMLInputSelectElement(''selHandlerCatArt''.$cnumber, 1, '''', true);\r\n   $oOption           = new cHTMLOptionElement(mi18n("- Please select -"), '''');\r\n   $oSelHandlerCatArt->addOptionElement(0, $oOption);\r\n   $oSelHandlerCatArt->addCategories(0, true, false, false, true, true);\r\n   $oSelHandlerCatArt->setDefault($iHandlerCatArt);\r\n\r\n   $oCkbUpdate        = new cHTMLCheckbox(''ckbUpdateHandlerID''.$cnumber, ''enabled'');\r\n   $oCkbUpdate->setEvent(''click'', ''if (this.checked) {document.forms[0].selHandlerCatArt''.$cnumber.''.disabled = false;} else {document.forms[0].selHandlerCatArt''.$cnumber.''.disabled = true;}'');\r\n\r\n   $oCfgTable->setCell(''handler'', 0, mi18n("Handler Article:"));\r\n   $oCfgTable->setCell(''handler'', 1, $oSelHandlerCatArt->render()."\\n&nbsp;".$oCkbUpdate->toHTML(false).mi18n("Update"));\r\n\r\n   // Getting newsletter groups (if any)\r\n   $oRcpGroups = new RecipientGroupCollection;\r\n   $oRcpGroups->setWhere(''idclient'', $client);\r\n   $oRcpGroups->setWhere(''idlang'',   $lang);\r\n   $oRcpGroups->setWhere(''defaultgroup'', ''0'');\r\n   $oRcpGroups->setOrder(''defaultgroup DESC, groupname ASC'');\r\n   $oRcpGroups->query();\r\n   \r\n   // Join options\r\n   // If newsletter groups are available, provide group options, otherwise show only\r\n   // ''Default'' option. This is necessary, as there may have been groups specified (and used)\r\n   // but they have been deleted, later on.\r\n   \r\n   $oCfgTable->setCell(''join_01'', 0, mi18n("Join:"));\r\n   \r\n   if ($oRcpGroups->Count() == 0) {\r\n      // No groups available, only default group possible\r\n   \r\n      $oRadJoinDefault = new cHTMLRadioButton (''radJoin''.$cnumber, ''Default'', '''', true);\r\n      $oCfgTable->setCell(''join_01'', 1, $oRadJoinDefault->toHTML(false).mi18n("default group"));\r\n   } else {\r\n      // Groups available, show different group join options\r\n   \r\n      // Join default group only\r\n      if ($aSettings[''JoinSel''] == ''Default'') {\r\n         $oRadJoinDefault = new cHTMLRadioButton (''radJoin''.$cnumber, ''Default'', '''', true);\r\n      } else {\r\n         $oRadJoinDefault = new cHTMLRadioButton (''radJoin''.$cnumber, ''Default'');\r\n      }\r\n      $oRadJoinDefault->setEvent(''click'', "document.forms[0].elements[''ckbJoinMultiple".$cnumber."''].disabled = true; document.forms[0].selGroup".$cnumber.".disabled = true;");\r\n      $oCfgTable->setCell(''join_01'', 1, $oRadJoinDefault->toHTML(false).mi18n("default group"));\r\n      $oCfgTable->setRowBgColor(''join_01'', $cfg["color"]["table_dark"]);\r\n   \r\n      // Join admin selected groups automatically\r\n      if ($aSettings[''JoinSel''] == ''Selected'') {\r\n         $oRadJoinSelected = new cHTMLRadioButton (''radJoin''.$cnumber, ''Selected'', '''', true);\r\n      } else {\r\n         $oRadJoinSelected = new cHTMLRadioButton (''radJoin''.$cnumber, ''Selected'');\r\n      }\r\n      $oRadJoinSelected->setEvent(''click'', "document.forms[0].elements[''ckbJoinMultiple".$cnumber."''].disabled = false; document.forms[0].selGroup".$cnumber.".disabled = false;");\r\n      $oCfgTable->setCell(''join_02'', 0, '''');\r\n      $oCfgTable->setCell(''join_02'', 1, $oRadJoinSelected->toHTML(false).mi18n("selected group(s)"));\r\n      $oCfgTable->setRowBgColor(''join_02'', $cfg["color"]["table_dark"]);\r\n   \r\n      // Join the groups the user has selected (-> provide a list for the user), optionally, the user may select more than one group\r\n      if ($aSettings[''JoinSel''] == ''UserSelected'')\r\n      {\r\n         $oRadJoinUserSel  = new cHTMLRadioButton (''radJoin''.$cnumber, ''UserSelected'', '''', true);\r\n         $oCkbJoinMultiple = new cHTMLCheckbox (''ckbJoinMultiple''.$cnumber, ''enabled'', '''', $aSettings[''JoinMultiple'']);\r\n      } else {\r\n         $oRadJoinUserSel  = new cHTMLRadioButton (''radJoin''.$cnumber, ''UserSelected'');\r\n         $oCkbJoinMultiple = new cHTMLCheckbox (''ckbJoinMultiple''.$cnumber, ''enabled'', '''', false, true);\r\n      }\r\n      $oRadJoinUserSel->setEvent(''click'', "document.forms[0].elements[''ckbJoinMultiple".$cnumber."''].disabled = false; document.forms[0].selGroup".$cnumber.".disabled = false;");\r\n      $oCfgTable->setCell(''join_03'', 0, '''');\r\n      $oCfgTable->setCell(''join_03'', 1, $oRadJoinUserSel->toHTML(false).mi18n("group(s) as selected by user").''<br />''."\\n".$oCkbJoinMultiple->toHTML(false).mi18n("Multiple group selection allowed"));\r\n      $oCfgTable->setRowBgColor(''join_03'', $cfg["color"]["table_dark"]);\r\n   \r\n      $oCfgTable->setCell(''groups'', 0, mi18n("Select group(s):"));\r\n   \r\n      // Show groups\r\n      // Trick: To save multiple selections in <select>-Element, add some JS which saves the\r\n      // selection, comma separated in a hidden input field on change.\r\n      $sSkript = ''              <script type="text/javascript"><!--''."\\n".\r\n                 ''                  function fncUpdateSel() {''."\\n".\r\n                 ''                     var strSel = "";''."\\n".\r\n                 ''                     for(i = 0; i < document.forms[0].selGroup''.$cnumber.''.length; i++) {''."\\n".\r\n                 ''                        if(document.forms[0].selGroup''.$cnumber.''.options[i].selected == true) {''."\\n".\r\n                 ''                           if (strSel != "")''."\\n".\r\n                 ''                              strSel = strSel + ",";''."\\n".\r\n                 ''                           strSel = strSel + document.forms[0].selGroup''.$cnumber.''.options[i].value;''."\\n".\r\n                 ''                        }''."\\n".\r\n                 ''                     }''."\\n".\r\n                 ''                     document.forms[0].elements["hidJoinGroups''.$cnumber.''"].value = strSel;''."\\n".\r\n                 ''                  }''."\\n".\r\n                 ''                  //--></script>''."\\n";\r\n\r\n      if ($aSettings[''JoinSel''] == ''Default'') {\r\n         $oSelGroup = new cHTMLSelectElement (''selGroup''.$cnumber, '''', '''', true);\r\n      } else {\r\n         $oSelGroup = new cHTMLSelectElement (''selGroup''.$cnumber, '''');\r\n      }\r\n      $oSelGroup->setSize(5);\r\n      $oSelGroup->setMultiselect();\r\n      $oSelGroup->setEvent(''change'', "fncUpdateSel()");\r\n\r\n      $aGroups = explode('','', $aSettings[''JoinGroups'']);\r\n      while ($oRcpGroup = $oRcpGroups->next()) {\r\n         $iID = $oRcpGroup->get(''idnewsgroup'');\r\n         if (in_array ($iID, $aGroups)) {\r\n            $oOption = new cHTMLOptionElement($oRcpGroup->get(''groupname''), $iID, true);\r\n         } else {\r\n            $oOption = new cHTMLOptionElement($oRcpGroup->get(''groupname''), $iID, false);\r\n         }\r\n         $oSelGroup->addOptionElement($iID, $oOption);\r\n      }\r\n   \r\n      $oHidGroups = new cHTMLHiddenField (''hidJoinGroups''.$cnumber, $aSettings[''JoinGroups'']);\r\n      $oCfgTable->setCell(''groups'', 1, $sSkript.$oSelGroup->render().$oHidGroups->render());\r\n   }\r\n   \r\n   // Options: Message type (user [->selectbox], text or html)\r\n   $oCfgTable->setCell(''options_01'', 0, mi18n("Options:"));\r\n\r\n   $oSelMsgType = new cHTMLSelectElement (''selMessageType''.$cnumber);\r\n   $oOption = new cHTMLOptionElement(mi18n("User selected"), "user");\r\n   $oSelMsgType->addOptionElement(0, $oOption);\r\n   $oOption = new cHTMLOptionElement(mi18n("Text only"), "text");\r\n   $oSelMsgType->addOptionElement(1, $oOption);\r\n   $oOption = new cHTMLOptionElement(mi18n("HTML and text"), "html");\r\n   $oSelMsgType->addOptionElement(2, $oOption);\r\n   $oSelMsgType->setDefault($aSettings[''JoinMessageType'']);\r\n\r\n   $oCfgTable->setCell(''options_01'', 1, mi18n("Default message type:").''&nbsp;''.$oSelMsgType->render());\r\n\r\n   // Frontend Link\r\n   $oCfgTable->setCell(''link_01'', 0, mi18n("Frontend Users:"));\r\n   $oCkbLink = new cHTMLCheckbox(''ckbFrontendLink''.$cnumber, ''enabled'', '''', $aSettings[''FrontendLink'']);\r\n   \r\n   $sSkript = "if (this.checked) {\r\n                  document.forms[0].elements[''CMS_VAR[5]''][0].disabled = false;\r\n                  document.forms[0].elements[''CMS_VAR[5]''][1].disabled = false;\r\n                  document.forms[0].elements[''CMS_VAR[6]''][0].disabled = false;\r\n                  document.forms[0].elements[''CMS_VAR[6]''][1].disabled = false;\r\n                  document.forms[0].elements[''CMS_VAR[6]''][2].disabled = false;\r\n               } else {\r\n                  document.forms[0].elements[''CMS_VAR[5]''][0].disabled = true;\r\n                  document.forms[0].elements[''CMS_VAR[5]''][1].disabled = true;\r\n                  document.forms[0].elements[''CMS_VAR[6]''][0].disabled = true;\r\n                  document.forms[0].elements[''CMS_VAR[6]''][1].disabled = true;\r\n                  document.forms[0].elements[''CMS_VAR[6]''][2].disabled = true;}";\r\n   $oCkbLink->setEvent("click", $sSkript);\r\n\r\n   $oCfgTable->setCell(''link_01'', 1, $oCkbLink->toHTML(false).mi18n("Activate Link"));\r\n   $oCfgTable->setRowBgColor(''link_01'', $cfg["color"]["table_light"]);\r\n   \r\n   // Link: Activation options\r\n   $oCfgTable->setCell(''link_02'', 0, '''');\r\n   \r\n   switch ($aSettings[''FrontendConfirm''])\r\n   {\r\n      case "Nothing":\r\n         $oRadActivateUser    = new cHTMLRadioButton ("CMS_VAR[5]", "ActivateUser", "", false);\r\n         $oRadActivateNothing = new cHTMLRadioButton ("CMS_VAR[5]", "Nothing",      "", true);\r\n         break;\r\n      default:\r\n         $oRadActivateUser    = new cHTMLRadioButton ("CMS_VAR[5]", "ActivateUser", "", true);\r\n         $oRadActivateNothing = new cHTMLRadioButton ("CMS_VAR[5]", "Nothing",      "", false);\r\n   }\r\n\r\n   switch ($aSettings[''FrontendDel''])\r\n   {\r\n      case "DisableUser":\r\n         $oRadDelDelete  = new cHTMLRadioButton ("CMS_VAR[6]", "DeleteUser",  "", false);\r\n         $oRadDelDisable = new cHTMLRadioButton ("CMS_VAR[6]", "DisableUser", "", true);\r\n         $oRadDelNothing = new cHTMLRadioButton ("CMS_VAR[6]", "Nothing",     "", false);\r\n         break;\r\n      case "Nothing":\r\n         $oRadDelDelete  = new cHTMLRadioButton ("CMS_VAR[6]", "DeleteUser",  "", false);\r\n         $oRadDelDisable = new cHTMLRadioButton ("CMS_VAR[6]", "DisableUser", "", false);\r\n         $oRadDelNothing = new cHTMLRadioButton ("CMS_VAR[6]", "Nothing",     "", true);\r\n         break;\r\n      default:\r\n         $oRadDelDelete  = new cHTMLRadioButton ("CMS_VAR[6]", "DeleteUser",  "", true);\r\n         $oRadDelDisable = new cHTMLRadioButton ("CMS_VAR[6]", "DisableUser", "", false);\r\n         $oRadDelNothing = new cHTMLRadioButton ("CMS_VAR[6]", "Nothing",     "", false);\r\n   }\r\n\r\n   if ($aSettings[''FrontendLink''] == '''')\r\n   {\r\n      $oRadActivateUser->setDisabled(true);\r\n      $oRadActivateNothing->setDisabled(true);\r\n      $oRadDelDelete->setDisabled(true);\r\n      $oRadDelDisable->setDisabled(true);\r\n      $oRadDelNothing->setDisabled(true);\r\n   }\r\n   $oCfgTable->setCell(''link_02'', 1, mi18n("Confirmation means:").''<br />''.\r\n                                     $oRadActivateUser->toHTML(false).mi18n("Activate").\r\n                                     $oRadActivateNothing->toHTML(false).mi18n("No changes"));\r\n   $oCfgTable->setRowBgColor(''link_02'', $cfg["color"]["table_light"]);\r\n\r\n   // Link: Cancellation options\r\n   $oCfgTable->setCell(''link_03'', 0, '''');\r\n\r\n   $oCfgTable->setCell(''link_03'', 1, mi18n("Cancellation means:").''<br />''.\r\n                                     $oRadDelDelete->toHTML(false).mi18n("Delete").\r\n                                     $oRadDelDisable->toHTML(false).mi18n("Disable").\r\n                                     $oRadDelNothing->toHTML(false).mi18n("No changes"));\r\n   $oCfgTable->setRowBgColor(''link_03'', $cfg["color"]["table_light"]);\r\n\r\n   $oCfgTable->render(true);', '<?php\r\n// Initialisation\r\n$oClientLang = new cApiClientLanguage(false, $client, $lang);\r\n$oClient     = new cApiClient($client);\r\n$oRecipients = new RecipientCollection;\r\n$sMessage = "&nbsp;";\r\nunset($recipient); // Unset any existing recipient objects - note, that it must be $recipient for the plugins...\r\n\r\n$aSettings   = array();\r\n$aSettings[''JoinSel'']         = $oClientLang->getProperty(''newsletter'', ''joinsel'');\r\n$aSettings[''JoinMultiple'']    = $oClientLang->getProperty(''newsletter'', ''joinmultiple'');\r\n$aSettings[''JoinGroups'']      = $oClientLang->getProperty(''newsletter'', ''joingroups'');\r\n$aSettings[''JoinMessageType''] = $oClientLang->getProperty(''newsletter'', ''joinmessagetype'');\r\n$aSettings[''FrontendLink'']    = $oClient->getProperty(''newsletter'', ''frontendlink''); # Note: Stored for client, as frontendusers are language independent\r\n$aSettings[''FrontendConfirm''] = "CMS_VALUE[5]";\r\n$aSettings[''FrontendDel'']     = "CMS_VALUE[6]";\r\n$aSettings[''SenderEMail'']     = $oClient->getProperty(''global'', ''sender-email''); # This one could be recycled by other modules...\r\n$aSettings[''HandlerID'']       = $oClientLang->getProperty(''newsletter'', ''idcatart'');\r\n\r\n$sTemplate = ''newsletter_handler.html'';\r\n\r\nif (!isset($oPage) || !is_object($oPage)) {\r\n  $oPage = new Template;\r\n}\r\n$oPage->reset();\r\n\r\n// If there is no selection option set or if no groups has been selected, activate option Default\r\nif ($aSettings[''JoinSel''] == '''' || $aSettings[''JoinGroups''] == '''') {\r\n  $aSettings[''JoinSel''] = "Default";\r\n}\r\nif ($aSettings[''FrontendConfirm''] == '''') {\r\n  $aSettings[''FrontendConfirm''] = "ActivateUser";\r\n}\r\nif ($aSettings[''FrontendDel''] == '''') {\r\n  $aSettings[''FrontendDel''] = "DeleteUser";\r\n}\r\n\r\nif ($_POST[''action''] == "subscribe") {\r\n  if (!isset($_POST[''email'']) || !$_POST[''email'']) {\r\n     $sMessage = mi18n("Please specify an e-mail address.");\r\n  } elseif (!isValidMail($_POST[''email'']) || strpos($_POST[''email''], ",") != false || strpos($_POST[''email''], ";") != false) {\r\n     $sMessage = mi18n("Please specify a valid e-mail address.");\r\n  } elseif ($oRecipients->emailExists($_POST[''email''])) {\r\n     $sMessage = mi18n("This e-mail address has been already registered for the newsletter.");\r\n  } else {\r\n     $sEMail = preg_replace(''/[\\r\\n]+/'', '''', stripslashes($_POST[''email'']));\r\n     $sName  = stripslashes($_POST["emailname"]);\r\n\r\n     // Which newsletter type should the recipient receive?\r\n     switch ($aSettings[''JoinMessageType''])\r\n     {\r\n        case "user":\r\n           if ($_POST["selNewsletterType"] == 1) {\r\n              $iMessageType = 1; // html\r\n           } else {\r\n              $iMessageType = 0; // text\r\n           }\r\n           break;\r\n        case "html":\r\n           $iMessageType = 1; // html\r\n           break;\r\n        default:\r\n           $iMessageType = 0; // Default: text\r\n     }\r\n\r\n     // Analyze group specification\r\n     switch ($aSettings[''JoinSel''])\r\n     {\r\n        case "Selected":\r\n           $recipient = $oRecipients->create($sEMail, $sName, 0, $aSettings[''JoinGroups''], $iMessageType);\r\n           break;\r\n        case "UserSelected":\r\n           $iSelCount = count($_POST[''selNewsletterGroup'']);\r\n\r\n           if ($iSelCount == 0) {\r\n              $recipient = $oRecipients->create($sEMail, $sName, 0, "", $iMessageType); // No group selected\r\n           } else {\r\n              if ($iSelCount > 1 && $aSettings[''JoinMultiple''] != "enabled") {\r\n                 $sMessage = mi18n("Please select one group, only.");\r\n              } else {\r\n                 // Recipient wants to join special groups\r\n                 $aGroups = explode(",", $aSettings[''JoinGroups'']);\r\n\r\n                 /* Check, if received data is valid and matches the group selection */\r\n                 $bError = false;\r\n                 foreach ($_POST[''selNewsletterGroup''] as $iIDGroup)\r\n                 {\r\n                    if (!is_numeric($iIDGroup) || !in_array($iIDGroup, $aGroups))\r\n                    {\r\n                       $bError = true;\r\n                       break;\r\n                    }\r\n                 }\r\n\r\n                 if ($bError) {\r\n                    $sMessage = mi18n("There was an error processing your request. Please ask the webmaster for help.");\r\n                 } else {\r\n                    $recipient = $oRecipients->create($sEMail, $sName, 0, implode(",", $_POST[''selNewsletterGroup'']));\r\n                 }\r\n              }\r\n           }\r\n           break;\r\n        default:\r\n           $recipient = $oRecipients->create($sEMail, $sName, 0, "", $iMessageType);\r\n     }\r\n\r\n     if ($recipient)\r\n     {\r\n        // Add here code, if you like to store additional information per >recipient< (see frontenduser below)\r\n        // Example: $recipient->setProperty("contact", "firstname", $_REQUEST["firstname"]);\r\n        // contact/firstname have to match the values used in the firstname-recipient-plugin\r\n        // $_REQUEST["firstname"] contains the data from the input-field firstname in the\r\n        // Form module (-> there has to be a field with this name)\r\n        // Note: You should check the values you get (safety)!!!\r\n\r\n        $sBody = mi18n("txtMailSubscribe")."\\n".''<a href="''.$cfgClient[$client][''path''][''htmlpath'']."front_content.php?changelang=".$lang."&idcatart=".$aSettings[''HandlerID'']."&confirm=".$recipient->get("hash").''">''.$cfgClient[$client][''path''][''htmlpath'']."front_content.php?changelang=".$lang."&idcatart=".$aSettings[''HandlerID'']."&confirm=".$recipient->get("hash").''</a>''."\\n\\n";\r\n        if (sendHtmlMail($sBody, mi18n("Newsletter: Confirmation"), array(''name'' => $sName, ''email'' => $sEMail), $aSettings[''SenderEMail''], $aSettings[''SenderEMail''], ''mail''))\r\n        {\r\n           $sMessage = mi18n("Dear subscriber,<br>your e-mail address is now subscribed for our newsletter. You will now receive an e-mail asking you to confirm your subscription.");\r\n\r\n           if ($aSettings[''FrontendLink''] == "enabled")\r\n           {\r\n              $oFrontendUsers = new FrontendUserCollection;\r\n\r\n              if (!$oFrontendUsers->userExists($sEMail))\r\n              {\r\n                 if ($frontenduser = $oFrontendUsers->create($sEMail)) // it''s "frontenduser" (instead of oFrontendUser) for plugins...\r\n                 {\r\n                    // Add here code, if you like to store additional information per >frontenduser<\r\n                    // Example: $frontenduser->setProperty("contact", "firstname", $_REQUEST["firstname"]);\r\n                    // contact/firstname have to match the values used in the firstname-frontenduser-plugin\r\n                    // $_REQUEST["firstname"] contains the data from the input-field firstname in the\r\n                    // Form module (-> there has to be a field with this name)\r\n                    // Note: You should check the values you get (safety)!!!\r\n\r\n                    if ($aSettings[''FrontendConfirm''] == "ActivateUser")\r\n                    {\r\n                       // Inform about frontend user account creation\r\n                       $sMessage .= mi18n("<br><br>After the confirmation you will also receive a password which you can use with your e-mail address to logon to special areas on this website.");\r\n                    }\r\n                 } else {\r\n                    $sMessage .= mi18n("<br><br>Sorry, there was a problem creating your website account. Please ask the webmaster for help.");\r\n                 }\r\n              }\r\n           }\r\n        } else {\r\n           $sMessage = mi18n("Sorry, there was a problem sending the confirmation mail to your e-mail address. Please ask the webmaster for help.");\r\n        }\r\n     } else {\r\n        $sMessage = mi18n("Sorry, there was a problem subscribing your e-mail address for the newsletter. Please ask the webmaster for help.");\r\n     }\r\n  }\r\n} elseif ($_POST[''action''] == "delete") {\r\n  if (!isset($_POST[''email'']) || !$_POST[''email'']) {\r\n     $sMessage = mi18n("Please specify an e-mail address.");\r\n  } elseif (!isValidMail($_POST[''email'']) || strpos($_POST[''email''], ",") != false || strpos($_POST[''email''], ";") != false) {\r\n     $sMessage = mi18n("Please specify a valid e-mail address.");\r\n  } elseif ($recipient = $oRecipients->emailExists($_POST[''email''])) {\r\n     $sBody = mi18n("txtMailDelete")."\\n".$cfgClient[$client][''path''][''htmlpath'']."front_content.php?changelang=".$lang."&idcatart=".$aSettings[''HandlerID'']."&unsubscribe=".$recipient->get("hash")."\\n\\n";\r\n     if (sendHtmlMail($sBody, mi18n("Newsletter: Cancel subscription"), array(''name'' => '''', ''email'' => $_POST[''email'']), $aSettings[''SenderEMail''], $aSettings[''SenderEMail''], ''mail''))\r\n     {\r\n        $sMessage = mi18n("Dear subscriber,<br>a mail has been sent to your e-mail address. Please confirm the cancelation of the newsletter subscription.");\r\n     } else {\r\n        $sMessage = mi18n("Sorry, there was a problem sending you the cancelation confirmation e-mail. Please ask the webmaster for help.");\r\n     }\r\n  } else {\r\n     $sMessage = mi18n("Sorry, the e-mail address was not found.");\r\n  }\r\n} elseif (strlen($_GET[''confirm'']) == 30 && is_alphanumeric($_GET[''confirm''])) {\r\n  $oRecipients->setWhere("idclient", $client);\r\n  $oRecipients->setWhere("idlang", $lang);\r\n  $oRecipients->setWhere("hash", $_GET[''confirm'']);\r\n  $oRecipients->query();\r\n\r\n  if ($recipient = $oRecipients->next())\r\n  {\r\n     $iID    = $recipient->get("idnewsrcp"); // For some reason, $recipient may get invalid later on - save id\r\n     $sEMail = $recipient->get("email");     // ... and email\r\n     $recipient->set("confirmed", 1);\r\n     $recipient->set("confirmeddate", date("Y-m-d H:i:s"), false);\r\n     $recipient->set("deactivated", 0);\r\n     $recipient->store();\r\n\r\n     $sMessage = mi18n("Thank you! You have confirmed your subscription to our newsletter!");\r\n\r\n     $oNewsletters = New NewsletterCollection;\r\n     $oNewsletters->setWhere("idclient", $client);\r\n     $oNewsletters->setWhere("idlang", $lang);\r\n     $oNewsletters->setWhere("welcome", ''1'');\r\n     $oNewsletters->query();\r\n\r\n     if ($oNewsletter = $oNewsletters->next())\r\n     {\r\n        $aRecipients = array(); // Needed, as used by reference\r\n        $oNewsletter->sendDirect($aSettings[''HandlerID''], $iID, false, $aRecipients, $encoding[$lang]);\r\n\r\n        $sMessage .= mi18n(" The welcome newsletter is already on the way to you!");\r\n     }\r\n     \r\n     if ($aSettings[''FrontendLink''] == "enabled" && $aSettings[''FrontendConfirm''] == "ActivateUser")\r\n     {\r\n        $oFrontendUsers = new FrontendUserCollection;\r\n        $oFrontendUsers->setWhere("idclient", $client);\r\n        $oFrontendUsers->setWhere("username", $sEMail);\r\n        $oFrontendUsers->query();\r\n\r\n        if ($frontenduser = $oFrontendUsers->next())\r\n        {\r\n           $frontenduser->set("active", 1);\r\n           $sPassword = substr(md5(rand()),0,8); // Generating password\r\n           $frontenduser->set("password", $sPassword);\r\n           $frontenduser->store();\r\n\r\n           $sMessage .= mi18n("<br><br>Additionally, your website account has been activated. You can now use the following username and password to log in to access special areas on our website:<br>");\r\n           $sMessage .= mi18n("Username: ").$sEMail.mi18n("<br>Password: ").$sPassword;\r\n\r\n           $sBody = mi18n("txtMailPassword")."\\n\\n".mi18n("Username: ").$sEMail."\\n".mi18n("Password: ").$sPassword."\\n\\n".mi18n("Click here to login: ").$cfgClient[$client][''path''][''htmlpath'']."front_content.php?changelang=".$lang;\r\n           if (sendHtmlMail($sBody, mi18n("Website account"), array(''name'' => '''', ''email'' => $sEMail), $aSettings[''SenderEMail''], $aSettings[''SenderEMail''], ''mail''))\r\n           {\r\n              $sMessage .= mi18n("<br><br>The account details and the password has also been sent to your mail account.");\r\n           } else {\r\n              $sMessage .= mi18n("<br><br><b>Sorry, there was a problem sending you the account details by mail. Please remember the given password.</b><b>");\r\n           }\r\n        } else {\r\n           $sMessage .= mi18n("<br><br>Sorry, there was a problem activating your website account, also. Please ask the webmaster for help.");\r\n        }\r\n     }\r\n  } else {\r\n     $sMessage = mi18n("Sorry, there was a problem confirming your subscription. Please ask the webmaster for help.");\r\n  }\r\n} elseif (strlen($_GET[''stop'']) == 30 && is_alphanumeric($_GET[''stop''])) {\r\n  $oRecipients->setWhere("idclient", $client);\r\n  $oRecipients->setWhere("idlang", $lang);\r\n  $oRecipients->setWhere("hash", $_GET[''stop'']);\r\n  $oRecipients->query();\r\n\r\n  if ($recipient = $oRecipients->next())\r\n  {\r\n     $recipient->set("deactivated", 1);\r\n     $recipient->store();\r\n\r\n     $sMessage = mi18n("Your newsletter subscription has been paused.");\r\n  } else {\r\n     $sMessage = mi18n("Sorry, there was a problem pausing your newsletter subscription. Please ask the webmaster for help.");\r\n  }\r\n} elseif (strlen($_GET[''goon'']) == 30 && is_alphanumeric($_GET[''goon''])) {\r\n  $oRecipients->setWhere("idclient", $client);\r\n  $oRecipients->setWhere("idlang", $lang);\r\n  $oRecipients->setWhere("hash", $_GET[''goon'']);\r\n  $oRecipients->query();\r\n\r\n  if ($recipient = $oRecipients->next())\r\n  {\r\n     $recipient->set("deactivated", 0);\r\n     $recipient->store();\r\n\r\n     $sMessage = mi18n("Newsletter subscription has been resumed.");\r\n  } else {\r\n     $sMessage = mi18n("Sorry, there was a problem resuming your newsletter subscription. Please ask the webmaster for help.");\r\n  }\r\n} elseif (strlen($_GET[''unsubscribe'']) == 30 && is_alphanumeric($_GET[''unsubscribe''])) {\r\n  $oRecipients->setWhere("idclient", $client);\r\n  $oRecipients->setWhere("idlang", $lang);\r\n  $oRecipients->setWhere("hash", $_GET[''unsubscribe'']);\r\n  $oRecipients->query();\r\n  \r\n  if ($recipient = $oRecipients->next()) {\r\n     $sEMail = $recipient->get("email"); // Saving recipient e-mail address for frontend account\r\n     $oRecipients->delete($recipient->get("idnewsrcp"));\r\n\r\n     $sMessage = mi18n("Your e-mail address has been removed from our list of newsletter recipients.");\r\n\r\n     if ($aSettings[''FrontendLink''] == "enabled")\r\n     {\r\n        $oFrontendUsers = new FrontendUserCollection;\r\n        $oFrontendUsers->setWhere("idclient", $client);\r\n        $oFrontendUsers->setWhere("username", $sEMail);\r\n        $oFrontendUsers->query();\r\n\r\n        if ($frontenduser = $oFrontendUsers->next())\r\n        {\r\n           switch ($aSettings[''FrontendDel''])\r\n           {\r\n              case "DeleteUser": // Deleting frontend account\r\n                 $oFrontendUsers->delete($frontenduser->get("idfrontenduser"));\r\n                 $sMessage .= mi18n(" Your website account has been deleted.");\r\n                 break;\r\n              case "DisableUser": // Disabling frontend account\r\n                 $frontenduser->set("active", 0);\r\n                 $frontenduser->store();\r\n                 $sMessage .= mi18n(" Your website account has been disabled.");\r\n                 break;\r\n              default:\r\n           }\r\n        }\r\n     }\r\n  } else {\r\n     $sMessage = mi18n("Sorry, there was a problem removing your e-mail address. Please ask the webmaster for help.");\r\n  }\r\n}\r\n\r\n$oPage->set(''s'', ''CONTENT'', $sMessage);\r\n$oPage->generate(''templates/''.$sTemplate);\r\n?>', '', 0, NULL, NULL, '48a365b4ce1e322a55ae9017f3daf0c0', '2008-04-14 15:58:52', '2015-03-23 10:16:27');
INSERT INTO `!PREFIX!_mod` VALUES (19, 1, 'QR Code', 'Content', 'none', 'Generates a QR Code (Quick Response Code barcode) for\r\nthe set text or the article''s URI if no text was set.\r\n\r\nAuthor:   Spider IT Deutschland - Rene Mansveld\r\nVersion:  1.0 (2012-10-13)', NULL, '', '<?php\r\n    # Caution! No ''echo'' and no quotes!\r\n    CMS_QRCODE[1];\r\n?>', '', 0, NULL, NULL, '48a365b4ce1e322a55ae9017f3daf0c0', '2012-11-28 14:53:04', '2013-09-14 14:27:35');
INSERT INTO `!PREFIX!_mod` VALUES (20, 1, 'RSS Reader', 'Content', 'none', 'RSS Reader\r\n\r\nAutor:    Spider IT Deutschland - Rene Mansveld (www.Spider-IT.de)\r\nVersion:  2.13 (2013-09-18)\r\nBase:     RSS Reader by Timo Hummel and Andreas Lindner (4fb) (2005-09-30)\r\n\r\nChanges:\r\nVersion 2.13 (2013-09-18):\r\n - NEW: Support fuer ATOM-Feeds\r\n\r\nVersion 2.12 (2013-09-14):\r\n - NEW: Das Modul ist jetzt komplett uebersetzbar (auch der Input-Bereich)\r\n - NEW: Standardfeed (wenn nichts angegeben ist) ist jetzt http://www.drugcms.org/de/rss/news.html\r\n\r\nVersion 2.11 (2012-12-17):\r\n - BUGFIX: Encoding-Angabe des Mandanten wurde nicht richtig beruecksichtigt\r\n\r\nVersion 2.10 (2012-12-06):\r\n - BUGFIX: ''&'' in URLs werden jetzt in ''&amp;'' umgewandelt\r\n - NEW: Standardfeed (wenn nichts angegeben ist) ist jetzt http://www.conlite.org/de/rss/news.html\r\n\r\nVersion 2.9 (2012-09-12):\r\n - NEW: Unterstuetzung von Feeds per https per cURL\r\n - UPDATE: Sortierte Liste der Modul-Templates in der Konfiguration\r\n\r\nVersion 2.8 (2012-05-30):\r\n - BUGFIX: Ausgabe wird unterdrueckt wenn der Feed nicht erreichbar oder der Link falsch ist\r\n\r\nVersion 2.7 (2012-01-25):\r\n - BUGFIX: Die gecachte Datei wurde nicht korrekt weitergegeben\r\n\r\nVersion 2.6 (2011-12-09):\r\n - NEW: Feeds werden bis zu 5 Minuten gecached um uebermaessigen Anfragen zu vermeiden\r\n - NEW: Angabe von Dateiname moeglich um mehrere Feeds in eine Seite einzubinden\r\n\r\nVersion 2.5 (2011-04-07):\r\n - NEW: Moeglichkeit zum Anzeigen von Bildern aus dem Feed (Haekchen setzen)\r\n - UPDATE: Bessere Verarbeitung des XML-Codes durch neue Klasse "rss_php" von rssphp.net\r\n\r\nVersion 2.4 (2010-08-25):\r\n - BUGFIX: Bei manchen Hostern wird die Einstellung "allow_url_fopen" falsch gesetzt und ignoriert\r\n\r\nVersion 2.3 (2010-07-29):\r\n - BUGFIX: Variable $encoding in $rssencoding umbenannt wg. Session-Variable $encoding[]\r\n - NEW: Ausgabe in UTF-8 wenn in Contenido fuer den Mandant eingestellt\r\n\r\nVersion 2.2 (2009-12-01):\r\n - WORKAROUND: PHP Parser Fehler bei Input in UTF-8\r\n\r\nVersion 2.1 (2009-10-15):\r\n - BUGFIX: URL mit Parameter bei "allow_url_fopen = false" korrigiert\r\n\r\nVersion 2.0 (2009-10-12):\r\n - Dekodierung korrigiert\r\n - "allow_url_fopen" umgangen (tmp Datei)\r\n - Link "weiterlesen" abschaltbar', NULL, '?><?php\r\nif ((intval("CMS_VALUE[99]") == 1) && (strlen("CMS_VALUE[98]"))) {\r\n    unlink($cfgClient[$client][''path''][''frontend''] . ''cache/'' . "CMS_VALUE[98]");\r\n}\r\n$file = "CMS_VALUE[5]";\r\nif (strlen($file) == 0) {\r\n    $file = ''RSS-Reader.tmp'';\r\n}\r\n?>\r\n<input type="hidden" name="<?php echo "CMS_VAR[98]"; ?>" value="<?php echo $file; ?>" />\r\n<input type="hidden" id="<?php echo "CMS_VAR[99]"; ?>" name="<?php echo "CMS_VAR[99]"; ?>" value="" />\r\n<table>\r\n    <tr>\r\n        <td><?php echo mi18n("URL"); ?></td>\r\n        <td><input type="text" name="<?php echo "CMS_VAR[0]"; ?>" value="<?php echo "CMS_VALUE[0]"; ?>" style="width: 320px" onchange="document.getElementById(''<?php echo "CMS_VAR[99]"; ?>'').value=1" onblur="this.form.<?php echo "CMS_VAR[99]"; ?>.value=1" /></td>\r\n    </tr>\r\n    <tr>\r\n        <td><?php echo mi18n("RSS-Template"); ?></td>\r\n        <td>\r\n            <select name="<?php echo "CMS_VAR[1]"; ?>" size="1" style="width: 320px">\r\n                <option value=""><?php echo mi18n("Nichts ausgew&auml;hlt"); ?></option><?php\r\n$templates = array();\r\n$strPath_fs = $cfgClient[$client]["path"]["frontend"].''templates/'';\r\n$handle = opendir($strPath_fs);\r\nwhile ($entryName = readdir($handle)) {\r\n    $templates[] = $entryName;\r\n}\r\nsort($templates);\r\nforeach ($templates as $entryName) {\r\n    if (is_file($strPath_fs.$entryName)) { \r\n        if ("CMS_VALUE[1]"==$entryName) {\r\n            echo ''<option selected value="''.$entryName.''">''.$entryName.''</option>'';\r\n        } else {\r\n            echo ''<option value="''.$entryName.''">''.$entryName.''</option>'';\r\n        }\r\n    }\r\n}?>\r\n            </select>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td><?php echo mi18n("Anzahl Eintr&auml;ge"); ?></td>\r\n        <td><input type="text" name="<?php echo "CMS_VAR[2]"; ?>" value="<?php echo "CMS_VALUE[2]"; ?>" /></td>\r\n    </tr>\r\n    <tr>\r\n        <td><?php echo mi18n("Bilder ausgeben"); ?></td>\r\n        <td><input type="checkbox" name="<?php echo "CMS_VAR[4]"; ?>" value="1"<?php echo (("CMS_VALUE[4]" == "1") ? '' checked="checked"'' : ''''); ?> /></td>\r\n    </tr>\r\n    <tr>\r\n        <td><?php echo mi18n("Link &quot;Weiterlesen&quot;"); ?></td>\r\n        <td><input type="checkbox" name="<?php echo "CMS_VAR[3]"; ?>" value="1"<?php echo (("CMS_VALUE[3]" == "1") ? '' checked="checked"'' : ''''); ?> /></td>\r\n    </tr>\r\n    <tr>\r\n        <td><?php echo mi18n("Datei zum Zwischenspeichern"); ?></td>\r\n        <td><input type="text" name="<?php echo "CMS_VAR[5]"; ?>" value="<?php echo $file; ?>" style="width: 320px" onchange="document.getElementById(''<?php echo "CMS_VAR[99]"; ?>'').value=1" onblur="this.form.<?php echo "CMS_VAR[99]"; ?>.value=1" /></td>\r\n    </tr>\r\n</table>\r\n<?php', '<?php\r\ncInclude(''frontend'', ''includes/rss_php.php'');\r\ncInclude(''frontend'', ''includes/rss.inc.php'');\r\ncInclude(''frontend'', ''includes/class.myatomparser.php'');\r\n\r\n$sFeed = ((strlen("CMS_VALUE[0]")) ? "CMS_VALUE[0]" : ''http://www.drugcms.org/de/rss/news.html'');\r\n$FeedMaxItems = ((strlen("CMS_VALUE[2]")) ? intval("CMS_VALUE[2]") : 999);\r\n\r\n$cache = $cfgClient[$client]["path"]["frontend"] . ''cache/'';\r\n$file = ((strlen("CMS_VALUE[5]") == 0) ? ''RSS-Reader.tmp'' : "CMS_VALUE[5]");\r\n$fn = $cache . $file;\r\n\r\n$bBilderAusgeben = intval("CMS_VALUE[4]");\r\n\r\n$ok = true;\r\nif (is_file($fn)) {\r\n    if (filemtime($fn) < strtotime(''-5 Minutes'')) {\r\n        $ok = false;\r\n    }\r\n} else {\r\n    $ok = false;\r\n}\r\nif ($ok) {\r\n    $content = @file_get_contents($fn);\r\n    $content = explode("\\n", str_replace(array("\\r\\n", "\\r", "\\n"), "\\n", $content));\r\n    $sFeed = $fn;\r\n    $ini_ok = true;\r\n    $rssencoding = ''utf-8'';\r\n} else {\r\n    $content = myfile($sFeed);\r\n    if (count($content) > 1) {\r\n        # Preparse feed for an encoding and change it to utf-8 for saving\r\n        $sFeedContent = $content[0];\r\n        $p1 = strpos($sFeedContent, ''encoding='');\r\n        if ($p1 !== false) {\r\n            $c = substr($sFeedContent, ($p1 + 9), 1); # " or '' after encoding=\r\n            $p1 += 10;\r\n            $p2 = strpos($sFeedContent, $c, $p1);\r\n            $rssencoding = substr($sFeedContent, $p1, $p2 - $p1);\r\n        }\r\n        if (strtoupper($rssencoding) != ''UTF''.''-8'') {\r\n            # change the content to iso-8859-1 encoding for saving\r\n            $content[0] = str_replace(''iso-8859-1'', ''utf-8'', $content[0]);\r\n            $content[0] = str_replace(''ISO-8859-1'', ''utf-8'', $content[0]);\r\n            for ($i = 1; $i < count($content); $i ++) {\r\n                $content[$i] = utf8_encode($content[$i]);\r\n            }\r\n            $rssencoding = ''utf-8'';\r\n        }\r\n        # Save the file locally in a temporary file\r\n        if ($fp = fopen($fn, ''w'')) {\r\n            for ($i = 0; $i < count($content); $i ++) {\r\n                fputs($fp, $content[$i]);\r\n            }\r\n            fclose($fp);\r\n            $sFeed = $fn;\r\n            $ini_ok = true;\r\n        } else {\r\n            $ini_ok = false;\r\n        }\r\n    } else {\r\n        @unlink($fn);\r\n        $ini_ok = false;\r\n    }\r\n}\r\nif ($ini_ok) {\r\n    # Get the date format from the language settings\r\n    $oLang = new Language;\r\n    $oLang->loadByPrimaryKey($lang);\r\n    $dateFormat = $oLang->getProperty(''dateformat'', ''full'');\r\n    if (!strlen($dateFormat)) {\r\n        $dateFormat = ''Y-m-d'';\r\n    }\r\n    \r\n    # Parse the file and show it\r\n    $rss = new rss_php;\r\n    $rss->load($sFeed);\r\n    $items = $rss->getItems(true);\r\n    if (count($items)) {\r\n        $oTpl = new Template;\r\n        \r\n        $i = 0;\r\n        foreach ($items as $item) {\r\n            if ($i < $FeedMaxItems) {\r\n                $sTitle = prepareStringForOutput($item[''title''][''value''], $rssencoding);\r\n                $oTpl->set("d", "TITLE", $sTitle);\r\n                $oTpl->set("d", "DATE", date($dateFormat, strtotime($item[''pubDate''][''value''])));\r\n                $oTpl->set("d", "LINK", str_replace(array(''&'', ''&amp;amp;''), ''&amp;'', prepareStringForOutput($item[''link''][''value''], $rssencoding)));\r\n                $oTpl->set("d", "DESCRIPTION", prepareStringForOutput($item[''description''][''value''], $rssencoding));\r\n                $oTpl->set("d", "READ_ON", (("CMS_VALUE[3]" == "1") ? mi18n("weiterlesen") : ''''));\r\n                $sImage = str_replace(''.thumbnail'', '''', $item[''enclosure''][''properties''][''url'']);\r\n                if ((strlen($sImage)) && ($bBilderAusgeben)) {\r\n                    $oTpl->set("d", "IMAGE", ''<img src="'' . $sImage . ''" alt="'' . $sTitle . ''" title="'' . $sTitle . ''"/>'');\r\n                } else {\r\n                    $oTpl->set("d", "IMAGE", '''');\r\n                }\r\n                $oTpl->next();\r\n            }\r\n            $i++;\r\n        }\r\n        \r\n        $oTpl->generate($cfgClient[$client]["path"]["frontend"] . "templates/" . "CMS_VALUE[1]");\r\n    } else {\r\n        # Try to get the feed as atom feed\r\n        $atom = new myAtomParser($sFeed);\r\n        $items = $atom->getRawOutput($encoding[$lang]);\r\n        if (count($items)) {\r\n            $oTpl = new Template;\r\n                \r\n            $i = 0;\r\n            foreach ($items[''FEED''][''ENTRY''] as $item) {\r\n                if ($i < $FeedMaxItems) {\r\n                    $sTitle = prepareStringForOutput($item[''TITLE''], $rssencoding);\r\n                    $oTpl->set("d", "TITLE", $sTitle);\r\n                    $oTpl->set("d", "DATE", date($dateFormat, strtotime($item[''UPDATED''])));\r\n                    $oTpl->set("d", "LINK", str_replace(array(''&'', ''&amp;amp;''), ''&amp;'', prepareStringForOutput($item[''ID''], $rssencoding)));\r\n                    $desc = prepareStringForOutput($item[''CONTENT''], $rssencoding);\r\n                    if (strpos($desc, ''\\\\"'') !== false) {\r\n                        $desc = str_replace(''\\\\"'', ''"'', $desc);\r\n                    }\r\n                    $desc = str_replace(array(''<a '', ''<A ''), array(''<a target="_blank" '', ''<A TARGET="_blank" ''), $desc);\r\n                    $oTpl->set("d", "DESCRIPTION", $desc);\r\n                    $oTpl->set("d", "READ_ON", (("CMS_VALUE[3]" == "1") ? mi18n("weiterlesen") : ''''));\r\n                    $sImage = str_replace(''.thumbnail'', '''', $item[''enclosure''][''properties''][''url'']);\r\n                    if ((strlen($sImage)) && ($bBilderAusgeben)) {\r\n                        $oTpl->set("d", "IMAGE", ''<img src="'' . $sImage . ''" alt="'' . $sTitle . ''" title="'' . $sTitle . ''"/>'');\r\n                    } else {\r\n                        $oTpl->set("d", "IMAGE", '''');\r\n                    }\r\n                    $oTpl->next();\r\n                }\r\n                $i++;\r\n            }\r\n            \r\n            $oTpl->generate($cfgClient[$client]["path"]["frontend"] . "templates/" . "CMS_VALUE[1]");\r\n        }\r\n    }\r\n}\r\n?>', '', 0, NULL, NULL, '48a365b4ce1e322a55ae9017f3daf0c0', '2008-04-14 15:59:19', '2013-10-08 10:44:31');